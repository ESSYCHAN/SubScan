(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43531,e=>{"use strict";e.s(["Check",()=>t],43531);let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},75254,e=>{"use strict";e.s(["default",()=>s],75254);var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)((e,r)=>{let{color:i="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:r,...n,width:s,height:s,stroke:i,strokeWidth:o?24*Number(l)/Number(s):l,className:a("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[r,a]=e;return(0,t.createElement)(r,a)}),...Array.isArray(d)?d:[d]])}),s=(e,n)=>{let s=(0,t.forwardRef)((s,l)=>{let{className:o,...c}=s;return(0,t.createElement)(i,{ref:l,iconNode:n,className:a("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...c})});return s.displayName=r(e),s}},63209,e=>{"use strict";e.s(["AlertCircle",()=>t],63209);let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},99749,e=>{"use strict";function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.s(["_",()=>t])},69074,e=>{"use strict";e.s(["Upload",()=>t],69074);let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},78583,87410,e=>{"use strict";e.s(["FileText",()=>t],78583);let t=(0,e.i(75254).default)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["BankStatementParser",()=>y,"default",()=>w],87410);let r=[{pattern:/netflix/i,category:"Entertainment",service:"Netflix"},{pattern:/spotify/i,category:"Music",service:"Spotify"},{pattern:/prime\s*video/i,category:"Video",service:"Prime Video"},{pattern:/amazon\s*prime(?!\s*video)/i,category:"Video",service:"Amazon Prime"},{pattern:/disney/i,category:"Video",service:"Disney+"},{pattern:/youtube.*premium/i,category:"Video",service:"YouTube Premium"},{pattern:/(?:apple(?:\s*\.?\s*com)?\s*\/?\s*bill|itunes|apple\s*services|app\s*store)/i,category:"Software",service:"Apple"},{pattern:/adobe/i,category:"Software",service:"Adobe"},{pattern:/microsoft|office 365/i,category:"Software",service:"Microsoft"},{pattern:/google.*one/i,category:"Cloud Storage",service:"Google One"},{pattern:/dropbox/i,category:"Cloud Storage",service:"Dropbox"},{pattern:/notion/i,category:"Productivity",service:"Notion"},{pattern:/github/i,category:"Software",service:"GitHub"},{pattern:/zoom/i,category:"Software",service:"Zoom"},{pattern:/openai/i,category:"Software",service:"OpenAI"},{pattern:/shopify/i,category:"Software",service:"Shopify"},{pattern:/docker/i,category:"Software",service:"Docker"},{pattern:/virgin.*active/i,category:"Fitness",service:"Virgin Active"},{pattern:/puregym/i,category:"Fitness",service:"PureGym"},{pattern:/\b(three|h3g)\b/i,category:"Telecom",service:"Three"},{pattern:/vodafone/i,category:"Telecom",service:"Vodafone"},{pattern:/\bee\b/i,category:"Telecom",service:"EE"},{pattern:/\bo2\b/i,category:"Telecom",service:"O2"},{pattern:/skillshare/i,category:"Software",service:"Skillshare"},{pattern:/interview\s*query/i,category:"Productivity",service:"Interview Query"},{pattern:/\bihsc\b/i,category:"Other",service:"IHSC Membership"},{pattern:/startup\s*plan/i,category:"Software",service:"Startup Plan"},{pattern:/\b(?:linkedin|linked\s*in|lnkd)\b.*\b(premium|prem|subscription|subs|navigator|recruiter)\b/i,category:"Productivity",service:"LinkedIn Premium"},{pattern:/cursor.*ai/i,category:"Software",service:"Cursor"},{pattern:/overleaf|sharelatex/i,category:"Software",service:"Overleaf"},{pattern:/\bindesign\b/i,category:"Software",service:"InDesign"}];function a(e){return r.some(t=>t.pattern.test(e))}let n=[/apple(\s*\.?\s*com)?\s*\/?\s*bill/i,/apple\s*services|app\s*store/i,/google\s*(one|play|storage)/i,/amazon\s*digital/i,/\b(three|vodafone|o2|ee)\b/i,/paypal/i],i=/(netflix|prime\s*video|amazon\s*prime|spotify|google\s*one|apple|openai|three|virgin\s*active|skillshare|notion|docker|overleaf|cursor|shopify|indesign|adobe|interview\s*query|linkedin\s*premium)/i,s=/,(?=(?:[^"]*"[^"]*")*[^"]*$)/,l=/(amazon\s*prime|prime\s*video|skillshare|linkedin\s*premium|dropbox|adobe|microsoft|github|notion|zoom)/i;function o(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function c(e){if(null==e)return null;let t=Number(String(e).replace(/[Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(t)?t:null}function d(e,t,r){return new Date(Date.UTC(e,t-1,r)).toISOString().slice(0,10)}function u(e){let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return d(+t[1],+t[2],+t[3]);let r=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/);if(r)return d(r[3].length<=2?+r[3]+2e3:+r[3],+r[2],+r[1]);let a=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})\b/);if(a){let e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(a[2].slice(0,3).toLowerCase());if(e>=0)return d(new Date().getFullYear(),e+1,+a[1])}return null}function m(e){return(e||"").replace(/\bfaster\s*payments\s*(receipt|received|to|from)\b/gi,"").replace(/^(CARD PAYMENT TO|BILL PAYMENT VIA FASTER PAYMENT TO|DIRECT DEBIT PAYMENT TO)\s*/i,"").replace(/\(VIA (APPLE|GOOGLE) PAY\)/i,"").replace(/\bpaypal(?:\s*\*|\s+payment|\s+ecom|\s+intl)?\s*/gi,"").replace(/\bpp\*\s*/gi,"").replace(/\b(REF|REFERENCE|CARD|POS|CONTACTLESS|ONLINE|ECOM|E-COMMERCE)\b/gi,"").replace(/\b(UK|GB|GBP)\b/gi,"").replace(/\b(LTD|LIMITED|PLC|LLC|INC)\b/gi,"").replace(/[0-9]{2,}/g,"").replace(/[^a-zA-Z\s+]/g," ").replace(/\s+/g," ").trim().split(" ").map(e=>e?e[0].toUpperCase()+e.slice(1).toLowerCase():"").join(" ")||"Unknown Service"}let p=/(subscription|subscrip|premium|membership|plan|renewal|direct\s*debit|mandate\s*no|autor?enew|annual|yearly)/i;function h(e){let t=new Map;for(let r of e){if(r.amount>=0)continue;let e=m(r.description);if(!e||"Unknown Service"===e)continue;let a=r.description.toLowerCase(),i=n.some(e=>e.test(a))?String(Math.round(100*Math.abs(r.amount))):"all",s="".concat(e.toLowerCase(),"__").concat(i);t.has(s)||t.set(s,[]),t.get(s).push(r)}let s=[];for(let[e,n]of t.entries()){var o;let t,c=(null==(o=n[0])?void 0:o.description)||e,d=n.map(e=>e.description).join(" ").toLowerCase(),u=/\bmandate\s*no\b/i.test(d)&&!r.some(e=>e.pattern.test(d))&&(d.match(/\b[A-Z][a-z]{2,}\b/g)||[]).length>=2&&d.length<200;if(u&&n.length<2||/(refund|reversal|chargeback|interest|paid in|credit|deposit)/.test(d))continue;let{name:h,merchant:f,conf:g}=function(e){let t=e.trim();for(let{pattern:e,service:a}of r)if(e.test(t))return{name:a,merchant:t,conf:95};return{name:m(t),merchant:t,conf:60}}(c),b=function(e){for(let{pattern:t,category:a}of r)if(t.test(e))return a;return"Other"}(h),x=n.map(e=>new Date(e.date)).filter(e=>!Number.isNaN(e.getTime())).sort((e,t)=>e-t);if(!x.length)continue;let v=n.map(e=>Math.abs(e.amount)).sort((e,t)=>e-t),y=v[Math.floor(v.length/2)],w=g>=90||/\bmandate\s*no\b/i.test(d)?.12:.06,N=v.every(e=>Math.abs(e-y)<=Math.max(1,y*w)),j=n.length>=2&&N,S=g>=90;if(S&&n.length<2&&y<2)continue;let D=p.test(d),k=y>=500,A=/\b(membership|annual|yearly|12\s*months|per\s*year|subscription|subscrip|plan|renewal)\b/i.test(d),C=/\bmandate\s*no\b/i.test(d),M=D&&!C,T=j||S||M||k&&(A||S);if(u&&!S&&!j&&y<500||!T)continue;let O=Number(Math.abs(j?function(e){let t=e.map(e=>Math.abs(e)).filter(e=>e>0);if(!t.length)return 0;let r=t.sort((e,t)=>e-t),a=Math.floor(r.length/2);return r.length%2?r[a]:(r[a-1]+r[a])/2}(n.map(e=>e.amount)):Math.abs(n[0].amount)).toFixed(2));if(O<=0)continue;let L="unknown";j?L=function(e){if(e.length<2)return"unknown";let t=[];for(let r=1;r<e.length;r++)t.push(Math.abs((e[r]-e[r-1])/864e5));let r=t.sort((e,t)=>e-t)[Math.floor(t.length/2)];return r>=6&&r<=8?"weekly":r>=26&&r<=35?"monthly":r>=360&&r<=380?"annual":"unknown"}(x):A||1===n.length&&(S||a(c))&&l.test(h)&&O>=60?L="annual":(S||a(c))&&i.test(h)&&(L="monthly");let P=5*!!/\b(direct\s*debit|mandate\s*no)\b/i.test(d),E=x[x.length-1],F=x[0];if("monthly"===L){let e=new Date(E);e.setMonth(e.getMonth()+1),t=e.toISOString().slice(0,10)}else if("weekly"===L){let e=new Date(E);e.setDate(e.getDate()+7),t=e.toISOString().slice(0,10)}else if("annual"===L){let e=new Date(E);e.setFullYear(e.getFullYear()+1),t=e.toISOString().slice(0,10)}s.push({name:h,merchant:f,serviceName:h,category:b,cost:O,frequency:L,billingDate:E.getDate(),dayOfMonth:E.getDate(),confidence:Math.min(100,g+5*("unknown"!==L)+P),source:"bank_scan",lastUsed:E.toISOString().slice(0,10),signUpDate:F.toISOString().slice(0,10),...t?{nextBilling:t}:{}})}return s}let f=["important information","compensation","fscs","account name","sort code","statement number","page number","date description money in money out balance","authorised by the prudential regulation authority","financial conduct authority","registered office","gross rate","aer","ear","overdraft","terms and conditions"].map(e=>e.toLowerCase()),g=["refund","reversal","chargeback","interest","paid in","credit","deposit","cashback","faster payments receipt","faster payments received","transfer from","incoming","salary","wages","hmrc","benefit","rebate","receipt"].map(e=>e.toLowerCase()),b=/(balance\s*(carried|brought)\s*forward|opening\s*balance|closing\s*balance|balance\s*[cb]\/f|\bb\/f\b|\bc\/f\b|balance\s+forward|carried\s+forward)/i;function x(e){return/^\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3}\b/.test(e)||/\b\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}\b/.test(e)}function v(e){let t=Array.from(e.slice(-140).matchAll(/Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?/g)).map(e=>e[0]).map((e,t)=>({value:(e=>{let t=/^\(.*\)$/.test(e),r=Number(e.replace(/[()Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(r)?Math.abs(t?-r:r):NaN})(e),hasPound:/Â£/.test(e),has2dp:/\.\d{2}\b/.test(e),i:t})).filter(e=>Number.isFinite(e.value)&&e.value>0&&e.value<=2e5);if(!t.length)return 0;let r=t.filter(e=>e.hasPound||e.has2dp);if(!r.length)return 0;(t=r).some(e=>e.value>=5)&&(t=t.filter(e=>e.value>=5));let a=t.map(e=>e.value);if(t.length>=3){let[e,r,a]=t.slice(-3).map(e=>e.value);if(a>=Math.max(e,r))return r}if(a.length>=2){let[e,t]=a.slice(-2);return t>1.5*e?e:Math.min(e,t)}return a[0]}class y{static parseTransactions(e){return h(e)}static parseStatementText(e){let t=h(!function(e){let t=(e.split(/\r?\n/)[0]||"").toLowerCase();return t.includes(",")&&/date|description|amount|merchant|details/.test(t)}(e)?function(e){let t=[];for(let r of e.split(/\r?\n/).filter(Boolean)){let e=r.toLowerCase(),n=a(r);if(!n&&b.test(e)||!n&&g.some(t=>e.includes(t)))continue;let i=u(r);if(!i)continue;let s=v(r);if(!s)continue;let{currency:l,amount:o,rate:c}=function(e){let t=e.match(/[, ](\d+(?:\.\d{2})?)\s*(USD|EUR|AUD|CAD)\b.*?(?:FX\s*RATE|RATE)[:\s]*([\d.]+)\s*\/?\s*GBP/i);return t?{currency:t[2],amount:Number(t[1]),rate:Number(t[3])}:{currency:"GBP"}}(r),d=-Math.abs("GBP"!==l&&o?"GBP"!==l&&c?o*c:o:s),m=r.replace(/\b(\d{4}-\d{2}-\d{2}|\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3,}(?:\s+\d{2,4})?)\b/,"").replace(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?)?\s*$/,"").trim()||"Unknown Service";t.push({date:i,description:m,amount:d,currency:l,exchangeRate:c})}return t}(e):function(e){let t=e.split(/\r?\n/).filter(Boolean);if(!t.length)return[];let r=t[0].split(s).map(o),a={date:-1,desc:-1,amount:-1,inAmt:-1,outAmt:-1,curr:-1,rate:-1};r.forEach((e,t)=>{let r=e.toLowerCase().trim();/(^| )date( |$)|transaction date|posted date/.test(r)&&(a.date=t),/description|details|merchant|narrative|transaction description|name/.test(r)&&(a.desc=t),/amount(?!.*(in|out))/.test(r)&&(a.amount=t),/money in|credit amount|paid in|deposit/.test(r)&&(a.inAmt=t),/money out|debit amount|paid out|withdrawal/.test(r)&&(a.outAmt=t),/currency/.test(r)&&(a.curr=t),/rate|exchange/.test(r)&&(a.rate=t)});let n=[];for(let e of t.slice(1)){let t=e.split(s).map(o),r=a.date>=0?t[a.date]:void 0,i=a.desc>=0?t[a.desc]:void 0,l=null;a.amount>=0?l=c(t[a.amount]||""):(a.inAmt>=0||a.outAmt>=0)&&(l=((a.inAmt>=0?c(t[a.inAmt]||"0"):0)||0)-((a.outAmt>=0?c(t[a.outAmt]||"0"):0)||0));let d=r&&u(r)||null;if(!d||!i||!Number.isFinite(l))continue;let m=a.curr>=0&&t[a.curr]||"GBP",p=a.rate>=0&&c(t[a.rate]||"")||void 0;n.push({date:d,description:i,amount:l,currency:m,exchangeRate:p})}return n}(e));if(t.length<3){let r=h(function(e){let t=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).filter(e=>!/^--- Page \d+ ---$/i.test(e)).filter(e=>{let t=e.toLowerCase();if(f.some(e=>t.includes(e)))return!1;let r=(t.match(/\d/g)||[]).length;return!(t.length>180&&r<6)}),r=[],n="";for(let e=0;e<t.length;e++){let a=t[e],i=t[e+1]||"";if(x(a)){n&&(r.push(n.trim()),n=""),n=a,i&&!x(i)&&(n+=" "+i,e++);continue}n&&(n+=" "+a,/\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(a)&&(r.push(n.trim()),n=""))}n&&r.push(n.trim());let i=[];for(let e of r){let t=e.toLowerCase(),r=a(e);if(!r&&b.test(t)||!r&&g.some(e=>t.includes(e)))continue;let n=function(e){let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return d(+t[1],+t[2],+t[3]);if(t=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/))return d(t[3].length<=2?+t[3]+2e3:+t[3],+t[2],+t[1]);if(t=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})(?:\s+(\d{2,4}))?\b/)){let e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(t[2].slice(0,3).toLowerCase());if(e>=0)return d(t[3]?t[3].length<=2?+t[3]+2e3:+t[3]:new Date().getFullYear(),e+1,+t[1])}return null}(e),s=v(e);if(!n||!s)continue;let l=e.replace(/\b(20\d{2}|\d{2}[\/\-]\d{2}[\/\-]\d{2,4}|\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3,}(?:\s+\d{2,4})?)\b/,"").replace(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?)?\s*$/,"").trim()||"Unknown Service";i.push({date:n,description:l,amount:-s})}return i}(e)),n=e=>"".concat(e.name.toLowerCase(),"_").concat(Math.round(100*e.cost),"_").concat(e.frequency),i=new Map;for(let e of[...t,...r])i.set(n(e),e);t=[...i.values()]}return t}}let w=y},9375,e=>{"use strict";e.s(["useAuthState",()=>s]),e.i(51718);var t=e.i(18357),r=e.i(71645),a=function(){return(a=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=function(e){return{loading:null==e,value:e}},i=function(e){var t=e?e():void 0,i=(0,r.useReducer)(function(e,t){switch(t.type){case"error":return a(a({},e),{error:t.error,loading:!1,value:void 0});case"reset":return n(t.defaultValue);case"value":return a(a({},e),{error:void 0,loading:!1,value:t.value});default:return e}},n(t)),s=i[0],l=i[1],o=(0,r.useCallback)(function(){l({type:"reset",defaultValue:e?e():void 0})},[e]),c=(0,r.useCallback)(function(e){l({type:"error",error:e})},[]),d=(0,r.useCallback)(function(e){l({type:"value",value:e})},[]);return(0,r.useMemo)(function(){return{error:s.error,loading:s.loading,reset:o,setError:c,setValue:d,value:s.value}},[s.error,s.loading,o,c,d,s.value])},s=function(e,a){var n=i(function(){return e.currentUser}),s=n.error,l=n.loading,o=n.setError,c=n.setValue,d=n.value;return(0,r.useEffect)(function(){var r=(0,t.onAuthStateChanged)(e,function(e){var t,r,n,i;return t=void 0,r=void 0,n=void 0,i=function(){return function(e,t){var r,a,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){var o=[i,l];if(r)throw TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],a=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}}(this,function(t){switch(t.label){case 0:if(!(null==a?void 0:a.onUserChanged))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,a.onUserChanged(e)];case 2:return t.sent(),[3,4];case 3:return o(t.sent()),[3,4];case 4:return c(e),[2]}})},new(n||(n=Promise))(function(e,a){function s(e){try{o(i.next(e))}catch(e){a(e)}}function l(e){try{o(i.throw(e))}catch(e){a(e)}}function o(t){var r;t.done?e(t.value):((r=t.value)instanceof n?r:new n(function(e){e(r)})).then(s,l)}o((i=i.apply(t,r||[])).next())})},o);return function(){r()}},[e]),[d,l,s]}},79577,e=>{"use strict";e.s(["DateUtils",()=>r]);var t=e.i(99749);class r{static monthIndex(e){return this.MONTHS.indexOf(e.slice(0,3).toLowerCase())}static parseStatementDate(e,t){let a=e=>null==e?null!=t?t:new Date().getFullYear():String(e).length<=2?Number(e)+2e3:Number(e);{let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return this.formatISODate(new Date(Number(t[1]),Number(t[2])-1,Number(t[3])))}{let t=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/);if(t){let[e,r,n,i]=t;return this.formatISODate(new Date(a(i),Number(n)-1,Number(r)))}}{let t=e.match(/(?:^|\b)ON\s+(\d{1,2})-(\d{1,2})-(\d{2,4})\b/i);if(t){let[e,r,n,i]=t;return this.formatISODate(new Date(a(i),Number(n)-1,Number(r)))}}{let t=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})(?:\s+(\d{2,4}))?\b/);if(t){let[e,r,n,i]=t,s=this.monthIndex(n);if(s>=0)return this.formatISODate(new Date(a(i),s,Number(r)))}}{let a=e.match(/\b(\d{1,2})[ \-]([A-Za-z]{3,})[ \-]?(\d{2,4})?\b/);if(a){var n,i,s;let[,e,l,o]=a,c=null!=(s=null==(i=r.MONTHS)||null==(n=i.indexOf)?void 0:n.call(i,l.slice(0,3).toLowerCase()))?s:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(l.slice(0,3).toLowerCase());if(c>=0){let r=o?String(o).length<=2?Number(o)+2e3:Number(o):null!=t?t:new Date().getFullYear();return this.formatISODate(new Date(r,c,Number(e)))}}}{let t=e.match(/\b(\d{4})\/(\d{2})\/(\d{2})\b/);if(t)return this.formatISODate(new Date(Number(t[1]),Number(t[2])-1,Number(t[3])))}return null}static extractAmount(e){if(/\b(balance|bal\.?)\b/i.test(e))return 0;let t=Array.from(e.matchAll(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*(DR|CR))?/gi));if(!t.length)return 0;let r=t.map(e=>(e=>{let t=/^\(.*\)$/.test(e),r=Number(e.replace(/[()Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(r)?Math.abs(t?-r:r):NaN})((e[1]||"").trim())).filter(e=>Number.isFinite(e)&&e>0&&e<=2e4);return r.length?r.length>=2?r.slice(-2).sort((e,t)=>e-t)[0]:r[r.length-1]:0}static daysBetween(e,t){let r=new Date(e),a=new Date(t);if(isNaN(r.getTime())||isNaN(a.getTime()))throw Error("Invalid date format");return Math.abs(Math.floor((a.getTime()-r.getTime())/864e5))}static calculateNextBilling(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"monthly",r=new Date(e);if(isNaN(r.getTime()))return new Date().toISOString().slice(0,10);switch(t){case"weekly":r.setDate(r.getDate()+7);break;case"annual":r.setFullYear(r.getFullYear()+1);break;default:{let e=r.getDate();r.setMonth(r.getMonth()+1),r.getDate()!==e&&r.setDate(0)}}return this.formatISODate(r)}static amountsSimilar(e,t){if(!isFinite(e)||!isFinite(t))return!1;let r=Math.abs(e-t);return r<=1||r/Math.max(e,t)<=.06}static formatISODate(e){if(isNaN(e.getTime()))throw Error("Invalid date");return e.toISOString().slice(0,10)}static validateDate(e){let t=new Date(e);return!isNaN(t.getTime())&&t.getFullYear()>=2020&&2030>=t.getFullYear()}}(0,t._)(r,"MONTHS",["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"])},53028,e=>{"use strict";e.s(["default",()=>g],53028);var t=e.i(43476),r=e.i(71645),a=e.i(69074),n=e.i(75254);let i=(0,n.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var s=e.i(78583),l=e.i(63209);let o=(0,n.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var c=e.i(43531),d=e.i(47513),u=e.i(79577),m=e.i(87410),p=e.i(59141);e.i(36180);var h=e.i(98925),f=e.i(9375);function g(){let[e]=(0,f.useAuthState)(p.auth),[n,g]=(0,r.useState)(null),[b,x]=(0,r.useState)(""),[v,y]=(0,r.useState)([]),[w,N]=(0,r.useState)([]),[j,S]=(0,r.useState)(!1),[D,k]=(0,r.useState)(!1),[A,C]=(0,r.useState)(""),[M,T]=(0,r.useState)(!1),[O,L]=(0,r.useState)(!1);function P(e){return/^\s*\d{1,2}(st|nd|rd|th)?\s+[A-Za-z]{3}\b/.test(e)}let E=async e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;let a=d.ValidationUtils.validateFileUpload(r);if(!a.valid)return void C(a.error||"Invalid file");g(r),C(""),await F(r)};async function F(e){S(!0),N([]),y([]),L(!1);try{if(!d.ValidationUtils.checkRateLimit("pdf-extract",6,6e4))return void C("Too many attempts. Please wait a moment and try again.");let t=await e.arrayBuffer();window.pdfjsLib||(await new Promise((e,t)=>{let r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",r.onload=()=>e(),r.onerror=()=>t(Error("Failed to load pdf.js")),document.head.appendChild(r)}),window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let r=await window.pdfjsLib.getDocument({data:t}).promise,a="";for(let e=1;e<=r.numPages;e++){let t=await r.getPage(e),n=(await t.getTextContent()).items.map(e=>(e.str||"")+(e.hasEOL?"\n":" ")).join("").replace(/[ \t]+\n/g,"\n").replace(/\n{3,}/g,"\n\n");a+="\n--- Page ".concat(e," ---\n").concat(n,"\n")}x(a);let n=function(e){let t=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),r=[],a="";for(let e=0;e<t.length;e++){let n=t[e],i=t[e+1]||"",s=t[e+2]||"";if(P(n)){a&&(r.push(a.trim()),a=""),a=n,i&&!P(i)&&(a+=" "+i),/\d{1,3}(?:,\d{3})*(?:\.\d{2})\s+\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(s)?(a+=" "+s,e+=2):/\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(i)&&(a+=" "+i,e+=1);continue}a&&(a+=" "+n,/\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(n)&&(r.push(a.trim()),a=""))}return a&&r.push(a.trim()),r}(a),i=n.join("\n"),s=n.map((e,t)=>(function(e,t){let r=e.trim(),a=null!==u.DateUtils.parseStatementDate(r),n=u.DateUtils.extractAmount(r)>0,i=n&&r.length>10&&r.length<200;return{lineNumber:t,text:r,hasAmount:n,hasDate:a,potentialTransaction:i,length:r.length}})(e,t+1));y(s);let l=m.BankStatementParser.parseStatementText(i);N(l)}catch(e){console.error("PDF extraction error:",e),C("Failed to extract text: ".concat((null==e?void 0:e.message)||"Unknown error"))}finally{S(!1)}}let U=e=>{let t={};for(let[r,a]of Object.entries(e))void 0!==a&&("number"==typeof a&&Number.isNaN(a)||(t[r]=a));return t},I=async()=>{if(!(null==e?void 0:e.uid))return void C("Please sign in first to save detected subscriptions.");if(!w.length)return void C("No subscriptions detected to save.");if(!d.ValidationUtils.checkRateLimit("pdf:save:".concat(e.uid),3,2e4))return void C("Please wait a few seconds before saving again.");k(!0),C(""),L(!1);try{let t=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").slice(0,64),r=[];for(let a of w){let n="scan_".concat(e.uid,"_").concat(t(a.name),"_").concat(Math.round(100*a.cost),"_").concat(a.frequency),i=(0,h.doc)((0,h.collection)(p.db,"subscriptions"),n),s=U({userId:e.uid,...a,amount:a.cost,monthlyFee:a.cost,dayOfMonth:a.billingDate,updatedAt:h.Timestamp.now(),createdAt:h.Timestamp.now()});r.push((0,h.setDoc)(i,s,{merge:!0}))}await Promise.all(r),L(!0)}catch(e){console.error(e),C("Failed to save detected subscriptions.")}finally{k(!1)}};function R(e,t,r){let a=new Blob([e],{type:r}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=t,i.click(),URL.revokeObjectURL(n)}return(0,t.jsxs)("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"PDF Text Extractor"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Extract, detect subscriptions, and save to your SubScan"})]}),(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(M?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDrop:e=>{e.preventDefault(),T(!1);let t=e.dataTransfer.files[0];(null==t?void 0:t.name.endsWith(".pdf"))?(g(t),C(""),F(t)):C("Please drop a PDF file")},onDragEnter:e=>{e.preventDefault(),T(!0)},onDragLeave:e=>{e.preventDefault(),T(!1)},onDragOver:e=>{e.preventDefault(),T(!0)},children:[(0,t.jsx)(a.Upload,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"Drop your PDF file here, or click to browse"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"We extract text, detect recurring subs, and let you save them."})]}),(0,t.jsx)("input",{type:"file",accept:".pdf",onChange:E,className:"mt-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),A&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3",children:[(0,t.jsx)(l.AlertCircle,{className:"h-5 w-5 text-red-500 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,t.jsx)("p",{className:"text-sm text-red-700",children:A})]})]}),j&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"}),(0,t.jsx)("p",{className:"text-blue-800",children:"Processing PDFâ€¦"})]}),(v.length>0||w.length>0)&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-green-800 mb-2",children:"Extraction Complete"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:"Total Lines:"}),(0,t.jsx)("div",{className:"text-green-800",children:v.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:"With Amounts:"}),(0,t.jsx)("div",{className:"text-green-800",children:v.filter(e=>e.hasAmount).length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:"With Dates:"}),(0,t.jsx)("div",{className:"text-green-800",children:v.filter(e=>e.hasDate).length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:"Potential Txns:"}),(0,t.jsx)("div",{className:"text-green-800",children:v.filter(e=>e.potentialTransaction).length})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsxs)("button",{onClick:()=>{v.length&&R(["Line Number,Text,Has Amount,Has Date,Potential Transaction,Length",...v.map(e=>[e.lineNumber,'"'.concat(e.text.replace(/"/g,'""'),'"'),e.hasAmount,e.hasDate,e.potentialTransaction,e.length].join(","))].join("\n"),"pdf_analysis_".concat((null==n?void 0:n.name.replace(/\.pdf$/i,""))||"document",".csv"),"text/csv")},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,t.jsx)(i,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Download CSV Analysis"})]}),(0,t.jsxs)("button",{onClick:()=>{b&&R(b,"extracted_text_".concat((null==n?void 0:n.name.replace(/\.pdf$/i,""))||"document",".txt"),"text/plain")},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[(0,t.jsx)(s.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Download Full Text"})]}),v.length>0&&(0,t.jsxs)("button",{onClick:()=>(function(e,t){let r=function(e,t){let r=function(e){let t=(e.match(/\b(20\d{2})\b/g)||[]).map(Number);if(t.length)return t.sort((e,t)=>t-e)[0]}(t),a=[];for(let t of e){var n;let e=t.trim(),i=function(e,t){let r=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(r)return"".concat(r[1],"-").concat(r[2],"-").concat(r[3]);if(r=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/)){let e=r[3].length<=2?2e3+Number(r[3]):Number(r[3]),t=String(r[2]).padStart(2,"0"),a=String(r[1]).padStart(2,"0");return"".concat(e,"-").concat(t,"-").concat(a)}if(r=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})(?:\s+(\d{2,4}))?\b/)){let e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(r[2].slice(0,3).toLowerCase());if(e>=0){let a=r[3]?r[3].length<=2?2e3+Number(r[3]):Number(r[3]):null!=t?t:new Date().getFullYear(),n=String(e+1).padStart(2,"0"),i=String(r[1]).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(i)}}return null}(e,r);if(!i)continue;let s=function(e){let t=Array.from(e.matchAll(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)/g)),r=[];for(let e of t){let t=e[1],a=/^\(.*\)$/.test(t),n=Number(t.replace(/[()Â£,\s]/g,"").replace(/\u2212/g,"-"));Number.isFinite(n)&&r.push(a?-Math.abs(n):Math.abs(n))}return r}(e);if(!s.length)continue;let l=s[0],o=s.length>1?s[s.length-1]:void 0,c=(n=e.toLowerCase(),/(refund|reversal|chargeback|interest|paid in|credit|deposit|\bcr\b)/.test(n))?Math.abs(l):-Math.abs(l),d=e.replace(/\b(\d{4}-\d{2}-\d{2}|\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3,}(?:\s+\d{2,4})?)\b/,"").replace(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s+\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)*\s*$/,"").replace(/\s+/g," ").trim()||"Unknown",u=Number(c.toFixed(2)),m=void 0!==o&&o!==l?Number(o.toFixed(2)):void 0;a.push({date:i,description:d,amount:u,money_out:u<0?Math.abs(u):0,money_in:u>0?u:0,balance:m,currency:"GBP",source_line:t})}return a}(e,t);if(!r.length)return;let a=new Blob([["date,description,amount,money_out,money_in,balance,currency,source_line",...r.map(e=>[e.date,'"'.concat(e.description.replace(/"/g,'""'),'"'),e.amount.toFixed(2),e.money_out?e.money_out.toFixed(2):"",e.money_in?e.money_in.toFixed(2):"",null!=e.balance?e.balance.toFixed(2):"",e.currency,'"'.concat(e.source_line.replace(/"/g,'""'),'"')].join(","))].join("\n")],{type:"text/csv"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download="transactions.csv",i.click(),URL.revokeObjectURL(n)})(v.map(e=>e.text),b),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:[(0,t.jsx)(i,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Export Transactions CSV"})]}),w.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:()=>{w.length&&R(["name,merchant,category,cost,frequency,billingDate,confidence,lastUsed,signUpDate,nextBilling",...w.map(e=>['"'.concat(e.name,'"'),'"'.concat(e.merchant,'"'),'"'.concat(e.category,'"'),e.cost.toFixed(2),e.frequency,e.billingDate,e.confidence,e.lastUsed||"",e.signUpDate||"",e.nextBilling||""].join(","))].join("\n"),"detected_subscriptions_".concat((null==n?void 0:n.name.replace(/\.pdf$/i,""))||"document",".csv"),"text/csv")},className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:[(0,t.jsx)(i,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Export Detected Subs"})]}),(0,t.jsxs)("button",{onClick:I,disabled:D,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-white ".concat(D?"bg-gray-400":"bg-purple-600 hover:bg-purple-700"),children:[D?(0,t.jsx)(o,{className:"h-4 w-4"}):(0,t.jsx)(c.Check,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:D?"Savingâ€¦":O?"Saved!":"Save to Subscriptions"})]})]})]}),w.length>0&&(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Detected Subscriptions"}),(0,t.jsx)("div",{className:"grid gap-2 max-h-64 overflow-y-auto",children:w.slice(0,20).map((e,r)=>(0,t.jsxs)("div",{className:"text-sm border rounded-xl p-3 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900 truncate",children:[e.name," ",(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.category,")"]})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 truncate",children:e.merchant}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:["Â£",e.cost.toFixed(2)," â€¢ ",e.frequency," â€¢ day ",e.billingDate," â€¢ conf ",e.confidence]})]}),(0,t.jsxs)("div",{className:"text-right text-xs text-gray-500",children:[(0,t.jsxs)("div",{children:["last: ",e.lastUsed||"-"]}),e.nextBilling&&(0,t.jsxs)("div",{children:["next: ",e.nextBilling]})]})]},r))})]}),(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Preview â€” Potential Transactions"}),(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:v.filter(e=>e.potentialTransaction).slice(0,20).map((e,r)=>(0,t.jsxs)("div",{className:"text-sm border-b pb-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-gray-600",children:["Line ",e.lineNumber,":"]}),(0,t.jsxs)("div",{className:"space-x-2",children:[e.hasAmount&&(0,t.jsx)("span",{className:"text-green-600 text-xs",children:"ðŸ’°"}),e.hasDate&&(0,t.jsx)("span",{className:"text-blue-600 text-xs",children:"ðŸ“…"})]})]}),(0,t.jsxs)("p",{className:"text-gray-800 font-mono text-[11px] break-all",children:[e.text.slice(0,220),"â€¦"]})]},r))})]})]})]})}}]);