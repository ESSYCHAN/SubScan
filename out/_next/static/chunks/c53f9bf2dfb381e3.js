(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55711,e=>{"use strict";e.s(["Brain",()=>t],55711);let t=(0,e.i(75254).default)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]])},18566,(e,t,a)=>{t.exports=e.r(76562)},39312,e=>{"use strict";e.s(["Zap",()=>t],39312);let t=(0,e.i(75254).default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},31278,e=>{"use strict";e.s(["Loader2",()=>t],31278);let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},99749,e=>{"use strict";function t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e.s(["_",()=>t])},63209,e=>{"use strict";e.s(["AlertCircle",()=>t],63209);let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},75254,e=>{"use strict";e.s(["default",()=>s],75254);var t=e.i(71645);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)((e,a)=>{let{color:n="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:d,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:a,...i,width:s,height:s,stroke:n,strokeWidth:l?24*Number(o)/Number(s):o,className:r("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[a,r]=e;return(0,t.createElement)(a,r)}),...Array.isArray(d)?d:[d]])}),s=(e,i)=>{let s=(0,t.forwardRef)((s,o)=>{let{className:l,...c}=s;return(0,t.createElement)(n,{ref:o,iconNode:i,className:r("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...c})});return s.displayName=a(e),s}},69074,e=>{"use strict";e.s(["Upload",()=>t],69074);let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},69638,e=>{"use strict";e.s(["CheckCircle",()=>t],69638);let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},78583,87410,e=>{"use strict";e.s(["FileText",()=>t],78583);let t=(0,e.i(75254).default)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["BankStatementParser",()=>v,"default",()=>w],87410);let a=[{pattern:/netflix/i,category:"Entertainment",service:"Netflix"},{pattern:/spotify/i,category:"Music",service:"Spotify"},{pattern:/prime\s*video/i,category:"Video",service:"Prime Video"},{pattern:/amazon\s*prime(?!\s*video)/i,category:"Video",service:"Amazon Prime"},{pattern:/disney/i,category:"Video",service:"Disney+"},{pattern:/youtube.*premium/i,category:"Video",service:"YouTube Premium"},{pattern:/(?:apple(?:\s*\.?\s*com)?\s*\/?\s*bill|itunes|apple\s*services|app\s*store)/i,category:"Software",service:"Apple"},{pattern:/adobe/i,category:"Software",service:"Adobe"},{pattern:/microsoft|office 365/i,category:"Software",service:"Microsoft"},{pattern:/google.*one/i,category:"Cloud Storage",service:"Google One"},{pattern:/dropbox/i,category:"Cloud Storage",service:"Dropbox"},{pattern:/notion/i,category:"Productivity",service:"Notion"},{pattern:/github/i,category:"Software",service:"GitHub"},{pattern:/zoom/i,category:"Software",service:"Zoom"},{pattern:/openai/i,category:"Software",service:"OpenAI"},{pattern:/shopify/i,category:"Software",service:"Shopify"},{pattern:/docker/i,category:"Software",service:"Docker"},{pattern:/virgin.*active/i,category:"Fitness",service:"Virgin Active"},{pattern:/puregym/i,category:"Fitness",service:"PureGym"},{pattern:/\b(three|h3g)\b/i,category:"Telecom",service:"Three"},{pattern:/vodafone/i,category:"Telecom",service:"Vodafone"},{pattern:/\bee\b/i,category:"Telecom",service:"EE"},{pattern:/\bo2\b/i,category:"Telecom",service:"O2"},{pattern:/skillshare/i,category:"Software",service:"Skillshare"},{pattern:/interview\s*query/i,category:"Productivity",service:"Interview Query"},{pattern:/\bihsc\b/i,category:"Other",service:"IHSC Membership"},{pattern:/startup\s*plan/i,category:"Software",service:"Startup Plan"},{pattern:/\b(?:linkedin|linked\s*in|lnkd)\b.*\b(premium|prem|subscription|subs|navigator|recruiter)\b/i,category:"Productivity",service:"LinkedIn Premium"},{pattern:/cursor.*ai/i,category:"Software",service:"Cursor"},{pattern:/overleaf|sharelatex/i,category:"Software",service:"Overleaf"},{pattern:/\bindesign\b/i,category:"Software",service:"InDesign"}];function r(e){return a.some(t=>t.pattern.test(e))}let i=[/apple(\s*\.?\s*com)?\s*\/?\s*bill/i,/apple\s*services|app\s*store/i,/google\s*(one|play|storage)/i,/amazon\s*digital/i,/\b(three|vodafone|o2|ee)\b/i,/paypal/i],n=/(netflix|prime\s*video|amazon\s*prime|spotify|google\s*one|apple|openai|three|virgin\s*active|skillshare|notion|docker|overleaf|cursor|shopify|indesign|adobe|interview\s*query|linkedin\s*premium)/i,s=/,(?=(?:[^"]*"[^"]*")*[^"]*$)/,o=/(amazon\s*prime|prime\s*video|skillshare|linkedin\s*premium|dropbox|adobe|microsoft|github|notion|zoom)/i;function l(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}function c(e){if(null==e)return null;let t=Number(String(e).replace(/[Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(t)?t:null}function d(e,t,a){return new Date(Date.UTC(e,t-1,a)).toISOString().slice(0,10)}function u(e){let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return d(+t[1],+t[2],+t[3]);let a=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/);if(a)return d(a[3].length<=2?+a[3]+2e3:+a[3],+a[2],+a[1]);let r=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})\b/);if(r){let e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(r[2].slice(0,3).toLowerCase());if(e>=0)return d(new Date().getFullYear(),e+1,+r[1])}return null}function m(e){return(e||"").replace(/\bfaster\s*payments\s*(receipt|received|to|from)\b/gi,"").replace(/^(CARD PAYMENT TO|BILL PAYMENT VIA FASTER PAYMENT TO|DIRECT DEBIT PAYMENT TO)\s*/i,"").replace(/\(VIA (APPLE|GOOGLE) PAY\)/i,"").replace(/\bpaypal(?:\s*\*|\s+payment|\s+ecom|\s+intl)?\s*/gi,"").replace(/\bpp\*\s*/gi,"").replace(/\b(REF|REFERENCE|CARD|POS|CONTACTLESS|ONLINE|ECOM|E-COMMERCE)\b/gi,"").replace(/\b(UK|GB|GBP)\b/gi,"").replace(/\b(LTD|LIMITED|PLC|LLC|INC)\b/gi,"").replace(/[0-9]{2,}/g,"").replace(/[^a-zA-Z\s+]/g," ").replace(/\s+/g," ").trim().split(" ").map(e=>e?e[0].toUpperCase()+e.slice(1).toLowerCase():"").join(" ")||"Unknown Service"}let p=/(subscription|subscrip|premium|membership|plan|renewal|direct\s*debit|mandate\s*no|autor?enew|annual|yearly)/i;function h(e){let t=new Map;for(let a of e){if(a.amount>=0)continue;let e=m(a.description);if(!e||"Unknown Service"===e)continue;let r=a.description.toLowerCase(),n=i.some(e=>e.test(r))?String(Math.round(100*Math.abs(a.amount))):"all",s="".concat(e.toLowerCase(),"__").concat(n);t.has(s)||t.set(s,[]),t.get(s).push(a)}let s=[];for(let[e,i]of t.entries()){var l;let t,c=(null==(l=i[0])?void 0:l.description)||e,d=i.map(e=>e.description).join(" ").toLowerCase(),u=/\bmandate\s*no\b/i.test(d)&&!a.some(e=>e.pattern.test(d))&&(d.match(/\b[A-Z][a-z]{2,}\b/g)||[]).length>=2&&d.length<200;if(u&&i.length<2||/(refund|reversal|chargeback|interest|paid in|credit|deposit)/.test(d))continue;let{name:h,merchant:g,conf:f}=function(e){let t=e.trim();for(let{pattern:e,service:r}of a)if(e.test(t))return{name:r,merchant:t,conf:95};return{name:m(t),merchant:t,conf:60}}(c),b=function(e){for(let{pattern:t,category:r}of a)if(t.test(e))return r;return"Other"}(h),y=i.map(e=>new Date(e.date)).filter(e=>!Number.isNaN(e.getTime())).sort((e,t)=>e-t);if(!y.length)continue;let x=i.map(e=>Math.abs(e.amount)).sort((e,t)=>e-t),v=x[Math.floor(x.length/2)],w=f>=90||/\bmandate\s*no\b/i.test(d)?.12:.06,N=x.every(e=>Math.abs(e-v)<=Math.max(1,v*w)),S=i.length>=2&&N,k=f>=90;if(k&&i.length<2&&v<2)continue;let D=p.test(d),A=v>=500,j=/\b(membership|annual|yearly|12\s*months|per\s*year|subscription|subscrip|plan|renewal)\b/i.test(d),M=/\bmandate\s*no\b/i.test(d),T=D&&!M,C=S||k||T||A&&(j||k);if(u&&!k&&!S&&v<500||!C)continue;let P=Number(Math.abs(S?function(e){let t=e.map(e=>Math.abs(e)).filter(e=>e>0);if(!t.length)return 0;let a=t.sort((e,t)=>e-t),r=Math.floor(a.length/2);return a.length%2?a[r]:(a[r-1]+a[r])/2}(i.map(e=>e.amount)):Math.abs(i[0].amount)).toFixed(2));if(P<=0)continue;let O="unknown";S?O=function(e){if(e.length<2)return"unknown";let t=[];for(let a=1;a<e.length;a++)t.push(Math.abs((e[a]-e[a-1])/864e5));let a=t.sort((e,t)=>e-t)[Math.floor(t.length/2)];return a>=6&&a<=8?"weekly":a>=26&&a<=35?"monthly":a>=360&&a<=380?"annual":"unknown"}(y):j||1===i.length&&(k||r(c))&&o.test(h)&&P>=60?O="annual":(k||r(c))&&n.test(h)&&(O="monthly");let I=5*!!/\b(direct\s*debit|mandate\s*no)\b/i.test(d),E=y[y.length-1],F=y[0];if("monthly"===O){let e=new Date(E);e.setMonth(e.getMonth()+1),t=e.toISOString().slice(0,10)}else if("weekly"===O){let e=new Date(E);e.setDate(e.getDate()+7),t=e.toISOString().slice(0,10)}else if("annual"===O){let e=new Date(E);e.setFullYear(e.getFullYear()+1),t=e.toISOString().slice(0,10)}s.push({name:h,merchant:g,serviceName:h,category:b,cost:P,frequency:O,billingDate:E.getDate(),dayOfMonth:E.getDate(),confidence:Math.min(100,f+5*("unknown"!==O)+I),source:"bank_scan",lastUsed:E.toISOString().slice(0,10),signUpDate:F.toISOString().slice(0,10),...t?{nextBilling:t}:{}})}return s}let g=["important information","compensation","fscs","account name","sort code","statement number","page number","date description money in money out balance","authorised by the prudential regulation authority","financial conduct authority","registered office","gross rate","aer","ear","overdraft","terms and conditions"].map(e=>e.toLowerCase()),f=["refund","reversal","chargeback","interest","paid in","credit","deposit","cashback","faster payments receipt","faster payments received","transfer from","incoming","salary","wages","hmrc","benefit","rebate","receipt"].map(e=>e.toLowerCase()),b=/(balance\s*(carried|brought)\s*forward|opening\s*balance|closing\s*balance|balance\s*[cb]\/f|\bb\/f\b|\bc\/f\b|balance\s+forward|carried\s+forward)/i;function y(e){return/^\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3}\b/.test(e)||/\b\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}\b/.test(e)}function x(e){let t=Array.from(e.slice(-140).matchAll(/Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?/g)).map(e=>e[0]).map((e,t)=>({value:(e=>{let t=/^\(.*\)$/.test(e),a=Number(e.replace(/[()Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(a)?Math.abs(t?-a:a):NaN})(e),hasPound:/Â£/.test(e),has2dp:/\.\d{2}\b/.test(e),i:t})).filter(e=>Number.isFinite(e.value)&&e.value>0&&e.value<=2e5);if(!t.length)return 0;let a=t.filter(e=>e.hasPound||e.has2dp);if(!a.length)return 0;(t=a).some(e=>e.value>=5)&&(t=t.filter(e=>e.value>=5));let r=t.map(e=>e.value);if(t.length>=3){let[e,a,r]=t.slice(-3).map(e=>e.value);if(r>=Math.max(e,a))return a}if(r.length>=2){let[e,t]=r.slice(-2);return t>1.5*e?e:Math.min(e,t)}return r[0]}class v{static parseTransactions(e){return h(e)}static parseStatementText(e){let t=h(!function(e){let t=(e.split(/\r?\n/)[0]||"").toLowerCase();return t.includes(",")&&/date|description|amount|merchant|details/.test(t)}(e)?function(e){let t=[];for(let a of e.split(/\r?\n/).filter(Boolean)){let e=a.toLowerCase(),i=r(a);if(!i&&b.test(e)||!i&&f.some(t=>e.includes(t)))continue;let n=u(a);if(!n)continue;let s=x(a);if(!s)continue;let{currency:o,amount:l,rate:c}=function(e){let t=e.match(/[, ](\d+(?:\.\d{2})?)\s*(USD|EUR|AUD|CAD)\b.*?(?:FX\s*RATE|RATE)[:\s]*([\d.]+)\s*\/?\s*GBP/i);return t?{currency:t[2],amount:Number(t[1]),rate:Number(t[3])}:{currency:"GBP"}}(a),d=-Math.abs("GBP"!==o&&l?"GBP"!==o&&c?l*c:l:s),m=a.replace(/\b(\d{4}-\d{2}-\d{2}|\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}|\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3,}(?:\s+\d{2,4})?)\b/,"").replace(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?)?\s*$/,"").trim()||"Unknown Service";t.push({date:n,description:m,amount:d,currency:o,exchangeRate:c})}return t}(e):function(e){let t=e.split(/\r?\n/).filter(Boolean);if(!t.length)return[];let a=t[0].split(s).map(l),r={date:-1,desc:-1,amount:-1,inAmt:-1,outAmt:-1,curr:-1,rate:-1};a.forEach((e,t)=>{let a=e.toLowerCase().trim();/(^| )date( |$)|transaction date|posted date/.test(a)&&(r.date=t),/description|details|merchant|narrative|transaction description|name/.test(a)&&(r.desc=t),/amount(?!.*(in|out))/.test(a)&&(r.amount=t),/money in|credit amount|paid in|deposit/.test(a)&&(r.inAmt=t),/money out|debit amount|paid out|withdrawal/.test(a)&&(r.outAmt=t),/currency/.test(a)&&(r.curr=t),/rate|exchange/.test(a)&&(r.rate=t)});let i=[];for(let e of t.slice(1)){let t=e.split(s).map(l),a=r.date>=0?t[r.date]:void 0,n=r.desc>=0?t[r.desc]:void 0,o=null;r.amount>=0?o=c(t[r.amount]||""):(r.inAmt>=0||r.outAmt>=0)&&(o=((r.inAmt>=0?c(t[r.inAmt]||"0"):0)||0)-((r.outAmt>=0?c(t[r.outAmt]||"0"):0)||0));let d=a&&u(a)||null;if(!d||!n||!Number.isFinite(o))continue;let m=r.curr>=0&&t[r.curr]||"GBP",p=r.rate>=0&&c(t[r.rate]||"")||void 0;i.push({date:d,description:n,amount:o,currency:m,exchangeRate:p})}return i}(e));if(t.length<3){let a=h(function(e){let t=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).filter(e=>!/^--- Page \d+ ---$/i.test(e)).filter(e=>{let t=e.toLowerCase();if(g.some(e=>t.includes(e)))return!1;let a=(t.match(/\d/g)||[]).length;return!(t.length>180&&a<6)}),a=[],i="";for(let e=0;e<t.length;e++){let r=t[e],n=t[e+1]||"";if(y(r)){i&&(a.push(i.trim()),i=""),i=r,n&&!y(n)&&(i+=" "+n,e++);continue}i&&(i+=" "+r,/\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(r)&&(a.push(i.trim()),i=""))}i&&a.push(i.trim());let n=[];for(let e of a){let t=e.toLowerCase(),a=r(e);if(!a&&b.test(t)||!a&&f.some(e=>t.includes(e)))continue;let i=function(e){let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return d(+t[1],+t[2],+t[3]);if(t=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/))return d(t[3].length<=2?+t[3]+2e3:+t[3],+t[2],+t[1]);if(t=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})(?:\s+(\d{2,4}))?\b/)){let e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(t[2].slice(0,3).toLowerCase());if(e>=0)return d(t[3]?t[3].length<=2?+t[3]+2e3:+t[3]:new Date().getFullYear(),e+1,+t[1])}return null}(e),s=x(e);if(!i||!s)continue;let o=e.replace(/\b(20\d{2}|\d{2}[\/\-]\d{2}[\/\-]\d{2,4}|\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3,}(?:\s+\d{2,4})?)\b/,"").replace(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?)?\s*$/,"").trim()||"Unknown Service";n.push({date:i,description:o,amount:-s})}return n}(e)),i=e=>"".concat(e.name.toLowerCase(),"_").concat(Math.round(100*e.cost),"_").concat(e.frequency),n=new Map;for(let e of[...t,...a])n.set(i(e),e);t=[...n.values()]}return t}}let w=v},87600,e=>{e.v("/_next/static/media/pdf.worker.min.fec13180.mjs")},79577,e=>{"use strict";e.s(["DateUtils",()=>a]);var t=e.i(99749);class a{static monthIndex(e){return this.MONTHS.indexOf(e.slice(0,3).toLowerCase())}static parseStatementDate(e,t){let r=e=>null==e?null!=t?t:new Date().getFullYear():String(e).length<=2?Number(e)+2e3:Number(e);{let t=e.match(/\b(\d{4})-(\d{2})-(\d{2})\b/);if(t)return this.formatISODate(new Date(Number(t[1]),Number(t[2])-1,Number(t[3])))}{let t=e.match(/\b(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})\b/);if(t){let[e,a,i,n]=t;return this.formatISODate(new Date(r(n),Number(i)-1,Number(a)))}}{let t=e.match(/(?:^|\b)ON\s+(\d{1,2})-(\d{1,2})-(\d{2,4})\b/i);if(t){let[e,a,i,n]=t;return this.formatISODate(new Date(r(n),Number(i)-1,Number(a)))}}{let t=e.match(/\b(\d{1,2})(?:st|nd|rd|th)?\s+([A-Za-z]{3,})(?:\s+(\d{2,4}))?\b/);if(t){let[e,a,i,n]=t,s=this.monthIndex(i);if(s>=0)return this.formatISODate(new Date(r(n),s,Number(a)))}}{let r=e.match(/\b(\d{1,2})[ \-]([A-Za-z]{3,})[ \-]?(\d{2,4})?\b/);if(r){var i,n,s;let[,e,o,l]=r,c=null!=(s=null==(n=a.MONTHS)||null==(i=n.indexOf)?void 0:i.call(n,o.slice(0,3).toLowerCase()))?s:["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(o.slice(0,3).toLowerCase());if(c>=0){let a=l?String(l).length<=2?Number(l)+2e3:Number(l):null!=t?t:new Date().getFullYear();return this.formatISODate(new Date(a,c,Number(e)))}}}{let t=e.match(/\b(\d{4})\/(\d{2})\/(\d{2})\b/);if(t)return this.formatISODate(new Date(Number(t[1]),Number(t[2])-1,Number(t[3])))}return null}static extractAmount(e){if(/\b(balance|bal\.?)\b/i.test(e))return 0;let t=Array.from(e.matchAll(/(\(?[-â€“âˆ’]?\s*Â£?\s*\d{1,3}(?:,\d{3})*(?:\.\d{2})?\)?)(?:\s*(DR|CR))?/gi));if(!t.length)return 0;let a=t.map(e=>(e=>{let t=/^\(.*\)$/.test(e),a=Number(e.replace(/[()Â£,\s]/g,"").replace(/\u2212/g,"-"));return Number.isFinite(a)?Math.abs(t?-a:a):NaN})((e[1]||"").trim())).filter(e=>Number.isFinite(e)&&e>0&&e<=2e4);return a.length?a.length>=2?a.slice(-2).sort((e,t)=>e-t)[0]:a[a.length-1]:0}static daysBetween(e,t){let a=new Date(e),r=new Date(t);if(isNaN(a.getTime())||isNaN(r.getTime()))throw Error("Invalid date format");return Math.abs(Math.floor((r.getTime()-a.getTime())/864e5))}static calculateNextBilling(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"monthly",a=new Date(e);if(isNaN(a.getTime()))return new Date().toISOString().slice(0,10);switch(t){case"weekly":a.setDate(a.getDate()+7);break;case"annual":a.setFullYear(a.getFullYear()+1);break;default:{let e=a.getDate();a.setMonth(a.getMonth()+1),a.getDate()!==e&&a.setDate(0)}}return this.formatISODate(a)}static amountsSimilar(e,t){if(!isFinite(e)||!isFinite(t))return!1;let a=Math.abs(e-t);return a<=1||a/Math.max(e,t)<=.06}static formatISODate(e){if(isNaN(e.getTime()))throw Error("Invalid date");return e.toISOString().slice(0,10)}static validateDate(e){let t=new Date(e);return!isNaN(t.getTime())&&t.getFullYear()>=2020&&2030>=t.getFullYear()}}(0,t._)(a,"MONTHS",["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"])},59434,e=>{"use strict";e.s(["default",()=>S,"extractSantanderTransactionsV2",()=>v],59434);var t=e.i(43476),a=e.i(71645),r=e.i(57951);e.i(36180);var i=e.i(98925),n=e.i(59141);let s=new class{async createSubscription(e,t){let a=i.Timestamp.now(),r={...t,userId:e,createdAt:a,updatedAt:a};return(await (0,i.addDoc)((0,i.collection)(n.db,"subscriptions"),r)).id}async getSubscriptions(e){let t=(0,i.query)((0,i.collection)(n.db,"subscriptions"),(0,i.where)("userId","==",e),(0,i.orderBy)("createdAt","desc"));return(await (0,i.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}))}async updateSubscription(e,t){let a=(0,i.doc)(n.db,"subscriptions",e);await (0,i.updateDoc)(a,{...t,updatedAt:i.Timestamp.now()})}async deleteSubscription(e){let t=(0,i.doc)(n.db,"subscriptions",e);await (0,i.deleteDoc)(t)}async createInsight(e,t){let a={...t,userId:e,createdAt:i.Timestamp.now()};return(await (0,i.addDoc)((0,i.collection)(n.db,"insights"),a)).id}async getInsights(e){let t=(0,i.query)((0,i.collection)(n.db,"insights"),(0,i.where)("userId","==",e),(0,i.where)("dismissed","==",!1),(0,i.orderBy)("createdAt","desc"));return(await (0,i.getDocs)(t)).docs.map(e=>({id:e.id,...e.data()}))}async dismissInsight(e){let t=(0,i.doc)(n.db,"insights",e);await (0,i.updateDoc)(t,{dismissed:!0})}generateSmartInsights(e){let t=[],a=new Date;return e.forEach(e=>{let r=e.daysSinceUsed||Math.floor((a.getTime()-new Date(e.lastUsed).getTime())/864e5),i="yearly"===e.billingCycle?e.cost/12:e.cost,n=new Date(e.signUpDate).getMonth();"fitness"===e.category&&(0===n&&a.getMonth()>2&&r>30&&t.push({type:"warning",title:"New Year Resolution Alert",message:"".concat(e.name," membership from January (Â£").concat(i.toFixed(2),"/month) - 80% abandon by April. Last visit: ").concat(r," days ago. Annual waste: Â£").concat((12*i).toFixed(2)),subscriptionId:e.id,saving:12*i,priority:"high",dismissed:!1}),i>30&&r>21&&t.push({type:"alert",title:"Expensive Unused Gym",message:"Paying Â£".concat(i.toFixed(2),"/month but last visit was ").concat(r," days ago. You could save Â£").concat((12*i).toFixed(2),"/year by canceling!"),subscriptionId:e.id,saving:12*i,priority:"high",dismissed:!1})),"entertainment"===e.category&&r>30&&t.push({type:"warning",title:"Forgotten Streaming Service",message:"".concat(e.name," unused for ").concat(r," days but still paying Â£").concat(i.toFixed(2),"/month. Cancel now to save Â£").concat((12*i).toFixed(2)," this year!"),subscriptionId:e.id,saving:12*i,priority:"high",dismissed:!1}),r>45&&"rarely"===e.usageFrequency&&t.push({type:"warning",title:"Long-Term Unused Subscription",message:"".concat(e.name," hasn't been used in ").concat(r," days and marked as rarely used. Consider canceling to save Â£").concat((12*i).toFixed(2),"/year."),subscriptionId:e.id,saving:12*i,priority:"medium",dismissed:!1})}),t.sort((e,t)=>{let a={high:3,medium:2,low:1};return a[t.priority]-a[e.priority]})}getAnalytics(e){let t=e.reduce((e,t)=>e+("monthly"===t.billingCycle?t.cost:t.cost/12),0),a=e.filter(e=>(e.daysSinceUsed||Math.floor((Date.now()-new Date(e.lastUsed).getTime())/864e5))>30||"rarely"===e.usageFrequency),r=12*a.reduce((e,t)=>e+("monthly"===t.billingCycle?t.cost:t.cost/12),0),i=e.filter(e=>"high"===e.risk),n=e.filter(e=>"medium"===e.risk),s=e.filter(e=>"low"===e.risk);return{totalMonthly:parseFloat(t.toFixed(2)),totalYearly:parseFloat((12*t).toFixed(2)),activeSubscriptions:e.length,unusedSubscriptions:a.length,potentialSavings:parseFloat(r.toFixed(2)),optimizedMonthly:parseFloat((t-r/12).toFixed(2)),highRiskSubscriptions:i.length,mediumRiskSubscriptions:n.length,lowRiskSubscriptions:s.length,bankProcessedCount:e.filter(e=>"bank_scan"===e.source).length}}};var o=e.i(18566),l=e.i(69074),c=e.i(78583),d=e.i(63209),u=e.i(69638),m=e.i(31278);let p=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var h=e.i(39312),g=e.i(55711),f=e.i(79577),b=e.i(47513),y=e.i(87410);function x(e){return e.replace(/CARD PAYMENT TO\s*/i,"").replace(/DIRECT DEBIT PAYMENT TO\s*/i,"").replace(/\(VIA APPLE PAY\)/i,"").replace(/\s+ON\s*$/i,"").replace(/\s{2,}/g," ").replace(/[^a-zA-Z0-9\s.&-]/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase())}async function v(t){let a=await e.A(25834);a.GlobalWorkerOptions.workerSrc=new e.U(e.r(87600)).toString();let r=await a.getDocument({data:new Uint8Array(t)}).promise,i=[],n=1,s=/\b(\d{2})-(\d{2})-(\d{4})\b/,o=RegExp("(?<!\\d)(\\d{1,6}\\.\\d{2})(?!\\d)"),l=e=>e.join(" ").replace(/\s{2,}/g," ").trim();for(let e=1;e<=r.numPages;e++){let t=await r.getPage(e),a=await t.getTextContent(),d=new Map;for(let e of a.items){var c;if(!("str"in e)||!(null==(c=e.str)?void 0:c.trim()))continue;let t=e.transform[4],a=Math.round(e.transform[5]);d.has(a)||d.set(a,[]),d.get(a).push({x:t,y:a,str:e.str.trim()})}for(let e of[...d.keys()].sort((e,t)=>t-e)){let t=d.get(e).sort((e,t)=>e.x-t.x),a=l(t.map(e=>e.str)),r=/^\s*(\d{1,2})(st|nd|rd|th)\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\b.*\b(20\d{2})\b/i,c=s.test(a),u=r.test(a);if(!c&&!u)continue;let m=null,p=-1/0,h=t.find(e=>s.test(e.str));if(h){let[e,t,r,i]=h.str.match(s)||a.match(s);m="".concat(i,"-").concat(r,"-").concat(t),p=h.x}else{let e=a.match(r),i=e[1].padStart(2,"0"),n=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(e[3].toLowerCase()),s=new Date(Number(e[4]),n,Number(i));m=isNaN(s.getTime())?null:s.toISOString().slice(0,10),p=Math.min(...t.map(e=>e.x))+1}if(!m)continue;let g=t.filter(e=>e.x>p).map(e=>{let t=e.str.match(o);return t?{x:e.x,val:parseFloat(t[1])}:null}).filter(Boolean);if(0===g.length)continue;g.sort((e,t)=>e.x-t.x);let f=g[0].val;g.length>=2&&(f=Math.min(g[0].val,g[1].val));let b=l(t.filter(e=>e.x<p).map(e=>e.str)),y=l(t.filter(e=>e.x>p).map(e=>e.str)),v=(()=>{for(let e of[b,y,a]){let t=e.match(/CARD PAYMENT TO\s+(.+?)\s+(?:ON\b|Â£|\d{2}-\d{2}-\d{4}|$)/i);if(t||(t=e.match(/(.+?)\s*\(VIA APPLE PAY\)/i))||(t=e.match(/DIRECT DEBIT PAYMENT TO\s+(.+?)\s+REF/i)))return x(t[1])}return x((b||y||a).split(/\s+/).slice(-6).join(" "))})();f<.5||f>1e3||i.push({id:"santander_".concat(n++),description:a,originalDescription:a,merchantName:function(e){let t=e.toLowerCase();return t.includes("apple.com")||t.includes("apple bill")?"Apple Services":t.includes("prime video")||t.includes("amazon prime")?"Amazon Prime":t.includes("google one")?"Google One":t.includes("linkedin premium")||t.includes("linkedinprea")?"LinkedIn Premium":x(e)}(v),amount:f,date:m,type:/apple pay/i.test(a)?"apple_pay":/direct debit/i.test(a)?"direct_debit":/card payment/i.test(a)?"card_payment":"unknown",category:"subscription"})}}return i}function w(e){return e.toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}let N=async e=>{let t=["uber","lyft","taxi","bus","train","tfl travel","stagecoach","lothian buses","oxford bus","restaurant","cafe","coffee","pub","takeaway","pizza","mcdonald","costa coffee","starbucks","greggs","tesco stores","asda stores","sainsburys","waitrose","co-op group","newington green fruit","ebay","argos","john lewis","marks spencer","matalan store","primark","h&m","zara","fuel","petrol","diesel","parking","toll","insurance","dentist","doctor","pharmacy","hospital","church","donation","wedding","funeral","charity","bill payment via faster payment","council tax","water bill","gas bill","electricity"],a={streaming:["netflix","amazon prime video","prime video","disney plus","disney+","now tv","sky go","spotify","apple music","youtube premium","bbc iplayer","itv hub"],software:["adobe","microsoft 365","office 365","google workspace","google one","canva pro","notion","slack","zoom","teams","dropbox pro","linkedin premium","skillshare","cursor","github","figma","openai","chatgpt plus","apple.com/bill","apple.com","apple services","startup plan"],telecom:["virgin media","bt broadband","ee monthly","three contract","o2 monthly","vodafone contract","three","o2","vodafone"],fitness:["virgin active","puregym","the gym group","david lloyd","nuffield health","peloton","fitness first"],news:["times subscription","guardian","financial times","economist","new york times","washington post"]},r=["subscription","monthly membership","annual plan","premium","pro plan","plus subscription"],i=(e||[]).map(e=>{var i,n;let s=(e.description||e.Description||e.Transaction||"").toLowerCase();if(t.some(e=>s.includes(e)))return null;let o=Math.abs(parseFloat((null==(i=e.amount)?void 0:i.toString())||(null==(n=e.Amount)?void 0:n.toString())||"0"))||0,l=[],c=.1;Object.entries(a).forEach(e=>{let[t,a]=e,r=a.filter(e=>s.includes(e));r.length&&(l.push({category:t,matches:r}),c+=.6)});let d=r.filter(e=>s.includes(e));if(d.length&&(c+=.3),o>0){o>=4.99&&o<=99.99&&(c+=.2);let e=o.toFixed(2);(e.endsWith(".99")||e.endsWith(".95"))&&(c+=.2),o<=50&&o%5==0&&(c+=.1)}(s.includes("direct debit")||s.includes("dd payment"))&&(c+=.3);let u=(()=>{let t=(e.date||e.Date||"").toString();if(!t)return new Date().toISOString().split("T")[0];let a=new Date(t);return isNaN(a.getTime())?new Date().toISOString().split("T")[0]:a.toISOString().split("T")[0]})(),m=function(e,t){let a={netflix:"Netflix","amazon prime video":"Amazon Prime Video","prime video":"Amazon Prime Video",spotify:"Spotify","apple music":"Apple Music","google one":"Google One","linkedin premium":"LinkedIn Premium",skillshare:"Skillshare",cursor:"Cursor AI",adobe:"Adobe Creative Cloud","microsoft 365":"Microsoft 365","office 365":"Office 365","virgin active":"Virgin Active",puregym:"PureGym",openai:"OpenAI","chatgpt plus":"ChatGPT Plus","apple.com/bill":"Apple Services","apple services":"Apple Services",three:"Three (H3G)"};for(let[t,r]of Object.entries(a))if(e.includes(t))return r;if(t.length>0&&t[0].matches.length>0){let e=t[0].matches[0];return a[e]||e.charAt(0).toUpperCase()+e.slice(1)}return e.replace(/card payment to /gi,"").replace(/direct debit payment to /gi,"").replace(/bill payment via faster payment to /gi,"").replace(/\(via apple pay\)/gi,"").replace(/on \d{2}-\d{2}-\d{4}/gi,"").replace(/[^a-zA-Z\s]/g," ").trim().split(/\s+/).filter(e=>e.length>2).slice(0,2).join(" ").replace(/\b\w/g,e=>e.toUpperCase())||"Unknown Service"}(s,l);return s.includes("amazon.co.uk")&&!/prime|digital|membership/.test(s)?null:{...e,id:"scan_".concat(Math.random().toString(36).substr(2,9)),isSubscription:!1,confidence:Math.min(c,1),merchantName:m,amount:o,date:u,categories:l,indicators:d,originalDescription:s,lastUsed:u,daysSinceUsed:Math.floor((Date.now()-new Date(u).getTime())/864e5),usageFrequency:"weekly"}}).filter(e=>!!e),n=function(e){let t=new Map;for(let a of e){let e=w(a.merchantName||"");e&&(t.has(e)||t.set(e,{name:a.merchantName,entries:[]}),t.get(e).entries.push({date:a.date,amount:a.amount}))}for(let e of t.values())e.entries=e.entries.filter(e=>!!e.date&&!isNaN(new Date(e.date).getTime())).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return t}(i.map(e=>({merchantName:e.merchantName,date:e.date,amount:e.amount})));for(let e of i){let t=w(e.merchantName),a=n.get(t);if(a&&a.entries.length>=2){let{boost:t,notes:r}=function(e){if(!e||e.length<2)return{boost:0,notes:[]};let t=0,a=0,r=1,i=[];for(let i=1;i<e.length;i++){let n=function(e,t){let a=new Date(e);return Math.abs(Math.floor((new Date(t).getTime()-a.getTime())/864e5))}(e[i-1].date,e[i].date),s=n>=25&&n<=35,o=function(e,t){if(!isFinite(e)||!isFinite(t))return!1;let a=Math.abs(e-t);return a<=1||a/Math.max(e,t)<=.06}(e[i-1].amount,e[i].amount);s?(t++,o&&a++,r++):r=1}let n=0;return t>=1&&(n+=.2,i.push("monthly cadence")),a>=1&&(n+=.1,i.push("stable pricing")),r>=3&&(n+=.15,i.push("3+ consecutive months")),n>.4&&(n=.4),{boost:n,notes:i}}(a.entries);t>0&&(e.confidence=Math.min(1,e.confidence+t),e.indicators=[...new Set([...e.indicators||[],...r])])}e.isSubscription=e.confidence>=.45}return i};function S(){let{user:n}=(0,r.useAuth)(),x=(0,o.useRouter)(),[w,S]=(0,a.useState)(null),[k,D]=(0,a.useState)(!1),[A,j]=(0,a.useState)(!1),[M,T]=(0,a.useState)(""),[C,P]=(0,a.useState)(""),[O,I]=(0,a.useState)(0),E=e=>f.DateUtils.extractAmount(e),F=e=>f.DateUtils.parseStatementDate(e),L=e=>{let t=e.toLowerCase();return["netflix","disney","amazon prime","spotify","apple music"].some(e=>t.includes(e))?"streaming":["gym","fitness","peloton","virgin active"].some(e=>t.includes(e))?"fitness":["adobe","microsoft","google","linkedin"].some(e=>t.includes(e))?"software":["deliveroo","uber eats","hello fresh"].some(e=>t.includes(e))?"food":"other"},U=e=>{let t=e.toLowerCase();return["spotify","apple music","microsoft"].some(e=>t.includes(e))?"daily":["netflix","disney"].some(e=>t.includes(e))?"weekly":["gym","adobe"].some(e=>t.includes(e))?"monthly":"rarely"},z=e=>e.confidence<.6?"medium":e.amount>30?"high":"low",B=e=>{let t=new Date(e);return Math.floor((new Date().getTime()-t.getTime())/864e5)},R=async t=>{if(console.log("parseFileEnhanced called with file:",t.name),n){j(!0),I(0);try{let a=new FileReader;a.onload=async a=>{try{var r,o,l,c;let d=[];if(t.name.endsWith(".csv")||"text/csv"===t.type){let e=(null==(r=a.target)?void 0:r.result).split("\n").filter(e=>e.trim());if(e.length<2)return void T("CSV file appears to be empty or invalid");let t=e[0].split(",").map(e=>e.trim().replace(/['"]/g,""));d=e.slice(1).map((e,a)=>{let r=e.split(",").map(e=>e.trim().replace(/['"]/g,"")),i={};return t.forEach((e,t)=>{i[e]=r[t]||""}),i.originalIndex=a,i}).filter(e=>Object.values(e).some(e=>""!==e))}else if(t.name.match(/\.xlsx?$/i))try{let t=await e.A(42078),r=null==(o=a.target)?void 0:o.result,i=t.read(r,{type:"array"}),n=i.SheetNames[0],s=i.Sheets[n];d=t.utils.sheet_to_json(s)}catch(e){T("Excel file processing requires additional setup. Please use CSV format for now.");return}else if(t.name.endsWith(".pdf")||"application/pdf"===t.type){console.log("PDF detected, processing...");try{let t=null==(l=a.target)?void 0:l.result;if(console.log("ArrayBuffer size:",t.byteLength),!(d=await v(t))||0===d.length){console.log("No data from Santander extractor, trying fallback");let a=await e.A(25834);a.GlobalWorkerOptions.workerSrc=new e.U(e.r(87600)).toString();let r=new Uint8Array(t),i=await a.getDocument({data:r}).promise,n="";for(let e=1;e<=i.numPages;e++){let t=await i.getPage(e),a=(await t.getTextContent()).items.filter(e=>"str"in e&&"transform"in e).sort((e,t)=>Math.abs(t.transform[5]-e.transform[5])>2?t.transform[5]-e.transform[5]:e.transform[4]-t.transform[4]),r="",s=null;for(let e of a){let t=Math.round(e.transform[5]),a=e.str.trim();a&&(null!==s&&Math.abs(t-s)>2?r+="\n":r&&!r.endsWith(" ")&&(r+=" "),r+=a,s=t)}n+=r+"\n"}d=n.split("\n").map((e,t)=>({id:"fallback_".concat(t),description:e.trim(),amount:E(e),date:F(e)||new Date().toISOString().slice(0,10),category:"Unknown"})).filter(e=>e.amount>0)}console.log("PDF parsed transactions:",d.slice(0,10))}catch(e){console.error("PDF parsing error:",e),T("Could not process PDF. Please try exporting as CSV from your online banking instead.");return}}else{let e=null==(c=a.target)?void 0:c.result;try{let t=y.BankStatementParser.parseStatementText(e);t.length>0?(console.log("Bank parser found ".concat(t.length," subscriptions")),d=t.map((e,t)=>({id:"bank_".concat(t),description:e.merchant,originalDescription:e.merchant,merchantName:e.name,amount:e.cost,date:e.lastUsed,category:e.category}))):d=e.split("\n").filter(e=>e.trim()).map((e,t)=>({id:t+1,description:e.trim(),amount:E(e),date:F(e)||new Date().toISOString().split("T")[0],category:"Unknown"}))}catch(t){console.log("Bank parser failed, using fallback:",t),d=e.split("\n").filter(e=>e.trim()).map((e,t)=>({id:t+1,description:e.trim(),amount:E(e),date:F(e)||new Date().toISOString().split("T")[0],category:"Unknown"}))}}if(0===d.length)return void T("No valid transactions found in the file");d=(d||[]).filter(e=>!(e.description||"").toLowerCase().includes("balance")&&e.amount>=.5&&e.amount<=1e3),console.log("[SCAN] raw parsed rows:",d.length);let u=await N(d);console.log("[SCAN] after detectSubscriptions:",u.length);let m=u.filter(e=>e.isSubscription),p=u.filter(e=>e.confidence>=.35&&e.confidence<.45);console.log("[SCAN] subs>=0.45:",m.length," maybe 0.35â€“0.44:",p.length),console.table(m.slice(0,15).map(e=>({date:e.date,merchant:e.merchantName,amt:e.amount,conf:e.confidence})));let h=u.filter(e=>e.isSubscription&&e.confidence>.3);if(0===h.length)return void P("Analyzed ".concat(u.length," transactions but found no clear subscription patterns. Try uploading a statement with more recurring payments."));let g=0;for(let e of h)try{let t=(e.merchantName||"Unknown Service").trim(),a=new Date,r={userId:n.uid,name:t,cleanName:e.merchantName,originalName:e.originalDescription||e.description||"Unknown",cost:e.amount,billingCycle:"monthly",nextBilling:function(e){let t=new Date(e);if(isNaN(t.getTime()))return new Date().toISOString().slice(0,10);let a=t.getDate(),r=new Date(t);return r.setMonth(r.getMonth()+1),r.getDate()!==a&&r.setDate(0),r.toISOString().slice(0,10)}(e.date),category:L(e.merchantName),lastUsed:e.date,usageFrequency:U(e.merchantName),signUpDate:e.date,source:"bank_scan",confidence:e.confidence,risk:z(e),daysSinceUsed:B(e.date),createdAt:i.Timestamp.fromDate(a),updatedAt:i.Timestamp.fromDate(a)};await s.createSubscription(n.uid,r),g++,I(g)}catch(e){console.error("Error saving subscription:",e)}P("Successfully processed ".concat(g," subscriptions from ").concat(u.length," transactions!")),setTimeout(()=>{x.push("/dashboard")},2e3)}catch(e){console.error("Parse error:",e),T("Error parsing file. Please check the format and try again.")}finally{j(!1)}},t.name.match(/\.xlsx?$/i)||t.name.endsWith(".pdf")?a.readAsArrayBuffer(t):a.readAsText(t)}catch(e){console.error("File read error:",e),T("Error reading file"),j(!1)}}},Y=(0,a.useCallback)(async e=>{if(console.log("handleFiles called with:",e.length,"files"),!e||0===e.length||!n)return;let t=e[0];console.log("Processing file:",t.name,t.type);let a=b.ValidationUtils.validateFileUpload(t);return a.valid?b.ValidationUtils.checkRateLimit("upload_".concat(n.uid),5,6e4)?void(S(t),T(""),P(""),await R(t)):void T("Too many uploads. Please wait a minute before trying again."):void T(a.error||"Invalid file type")},[n]),V=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?D(!0):"dragleave"===e.type&&D(!1)};return n?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("button",{onClick:()=>x.push("/dashboard"),className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[(0,t.jsx)(p,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Back to Dashboard"})]}),(0,t.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)(g.Brain,{className:"w-5 h-5 text-white"})})]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:n.displayName||n.email})]})})}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-8",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-full text-sm font-medium mb-4",children:[(0,t.jsx)(h.Zap,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Enhanced AI-Powered Subscription Detection v8.2"})]}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Bank Statement Scanner"}),(0,t.jsx)("p",{className:"text-gray-600 text-lg",children:"Upload your bank statement (PDF/CSV/TXT) and let our enhanced AI find all subscriptions"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,t.jsxs)("div",{className:"relative border-2 border-dashed rounded-xl p-12 text-center transition-all duration-200 ".concat(k?"border-blue-500 bg-blue-50 scale-105":"border-gray-300 hover:border-gray-400 hover:bg-gray-50"),onDragEnter:V,onDragLeave:V,onDragOver:V,onDrop:e=>{e.preventDefault(),e.stopPropagation(),D(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&Y(e.dataTransfer.files)},children:[(0,t.jsx)("input",{type:"file",accept:".csv,.xls,.xlsx,.txt,.pdf",onChange:e=>{e.preventDefault(),e.target.files&&e.target.files[0]&&Y(e.target.files)},className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:A}),(0,t.jsxs)("div",{className:"space-y-6",children:[A?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(m.Loader2,{className:"mx-auto h-16 w-16 text-blue-500 animate-spin"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:"Enhanced processing your file..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Advanced AI is analyzing your transactions"}),O>0&&(0,t.jsxs)("p",{className:"text-blue-600 mt-2",children:["Saved ",O," subscriptions to your account"]})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(l.Upload,{className:"mx-auto h-16 w-16 text-gray-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xl font-semibold text-gray-900",children:"Drop your statement here, or click to browse"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Enhanced support for CSV, Excel (XLS/XLSX), PDF, and TXT files"})]})]}),w&&!A&&(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-3 text-gray-600 bg-gray-50 p-4 rounded-lg",children:[(0,t.jsx)(c.FileText,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:w.name}),(0,t.jsxs)("span",{className:"text-sm",children:[(w.size/1024).toFixed(1)," KB"]})]})]})]}),M&&(0,t.jsxs)("div",{className:"mt-6 flex items-start space-x-3 text-red-600 bg-red-50 p-4 rounded-lg border border-red-200",children:[(0,t.jsx)(d.AlertCircle,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Upload Error"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:M})]})]}),C&&(0,t.jsxs)("div",{className:"mt-6 flex items-start space-x-3 text-green-600 bg-green-50 p-4 rounded-lg border border-green-200",children:[(0,t.jsx)(u.CheckCircle,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Success!"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:C}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Redirecting to your dashboard..."})]})]}),(0,t.jsx)("div",{className:"mt-8 text-center",children:(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4 text-sm text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,t.jsx)("span",{children:"100% Private & Secure"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),(0,t.jsx)("span",{children:"Enhanced AI Detection v8.2"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),(0,t.jsx)("span",{children:"Saves to Your Account"})]})]})})]}),(0,t.jsxs)("div",{className:"mt-8 bg-green-50 rounded-xl p-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"ðŸš€ Enhanced PDF Processing v8.2"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700",children:[(0,t.jsx)("div",{children:"â€¢ Leading-date capture for DD rows"}),(0,t.jsx)("div",{children:"â€¢ Santander transaction pattern recognition"}),(0,t.jsx)("div",{children:"â€¢ Recurrence-based confidence boost"}),(0,t.jsx)("div",{children:"â€¢ Expanded service alias normalization"}),(0,t.jsx)("div",{children:"â€¢ Better merchant name extraction"}),(0,t.jsx)("div",{children:"â€¢ Safer next-billing calculation"})]})]}),(0,t.jsxs)("div",{className:"mt-4 bg-blue-50 rounded-xl p-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Supported UK Banks"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-700",children:[(0,t.jsx)("div",{children:"â€¢ Lloyds Banking Group"}),(0,t.jsx)("div",{children:"â€¢ Barclays"}),(0,t.jsx)("div",{children:"â€¢ HSBC"}),(0,t.jsxs)("div",{children:["â€¢ ",(0,t.jsx)("strong",{children:"Santander UK âœ¨"})]}),(0,t.jsx)("div",{children:"â€¢ NatWest Group"}),(0,t.jsx)("div",{children:"â€¢ Monzo"}),(0,t.jsx)("div",{children:"â€¢ Starling Bank"}),(0,t.jsx)("div",{children:"â€¢ Revolut"})]})]})]})]}):null}},25834,e=>{e.v(t=>Promise.all(["static/chunks/2b59229223feafe9.js"].map(t=>e.l(t))).then(()=>t(18657)))},42078,e=>{e.v(t=>Promise.all(["static/chunks/e857d18f306dcf54.js"].map(t=>e.l(t))).then(()=>t(70016)))}]);