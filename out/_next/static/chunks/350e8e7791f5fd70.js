(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16015,(e,t,s)=>{},98547,(e,t,s)=>{var a=e.i(47167);e.r(16015);var r=e.r(71645),n=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(r),l=void 0!==a.default&&a.default.env&&!0,i=function(e){return"[object String]"===Object.prototype.toString.call(e)},d=function(){function e(e){var t=void 0===e?{}:e,s=t.name,a=void 0===s?"stylesheet":s,r=t.optimizeForSpeed,n=void 0===r?l:r;o(i(a),"`name` must be a string"),this._name=a,this._deletedRulePlaceholder="#"+a+"-deleted-rule____{}",o("boolean"==typeof n,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=n,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var d="undefined"!=typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=d?d.getAttribute("content"):null}var t,s=e.prototype;return s.setOptimizeForSpeed=function(e){o("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),o(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(o(!this._injected,"sheet already injected"),this._injected=!0,"undefined"!=typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(l||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,s){return"number"==typeof s?e._serverSheet.cssRules[s]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),s},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,t){if(o(i(e),"`insertRule` accepts only strings"),"undefined"==typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!=typeof t&&(t=s.cssRules.length);try{s.insertRule(e,t)}catch(t){return l||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var a=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,a))}return this._rulesCount++},s.replaceRule=function(e,t){if(this._optimizeForSpeed||"undefined"==typeof window){var s="undefined"!=typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(t,e)}catch(a){l||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),s.insertRule(this._deletedRulePlaceholder,e)}}else{var a=this._tags[e];o(a,"old rule at index `"+e+"` not found"),a.textContent=t}return e},s.deleteRule=function(e){if("undefined"==typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];o(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,"undefined"!=typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},s.cssRules=function(){var e=this;return"undefined"==typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,s){return s?t=t.concat(Array.prototype.map.call(e.getSheetForTag(s).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},s.makeStyleTag=function(e,t,s){t&&o(i(t),"makeStyleTag accepts only strings as second parameter");var a=document.createElement("style");this._nonce&&a.setAttribute("nonce",this._nonce),a.type="text/css",a.setAttribute("data-"+e,""),t&&a.appendChild(document.createTextNode(t));var r=document.head||document.getElementsByTagName("head")[0];return s?r.insertBefore(a,s):r.appendChild(a),a},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(e.prototype,t),e}();function o(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var c=function(e){for(var t=5381,s=e.length;s;)t=33*t^e.charCodeAt(--s);return t>>>0},u={};function m(e,t){if(!t)return"jsx-"+e;var s=String(t),a=e+s;return u[a]||(u[a]="jsx-"+c(e+"-"+s)),u[a]}function h(e,t){"undefined"==typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var s=e+t;return u[s]||(u[s]=t.replace(/__jsx-style-dynamic-selector/g,e)),u[s]}var x=function(){function e(e){var t=void 0===e?{}:e,s=t.styleSheet,a=void 0===s?null:s,r=t.optimizeForSpeed,n=void 0!==r&&r;this._sheet=a||new d({name:"styled-jsx",optimizeForSpeed:n}),this._sheet.inject(),a&&"boolean"==typeof n&&(this._sheet.setOptimizeForSpeed(n),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"undefined"==typeof window||this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var s=this.getIdAndRules(e),a=s.styleId,r=s.rules;if(a in this._instancesCounts){this._instancesCounts[a]+=1;return}var n=r.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[a]=n,this._instancesCounts[a]=1},t.remove=function(e){var t=this,s=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(s in this._instancesCounts,"styleId: `"+s+"` not found"),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var a=this._fromServer&&this._fromServer[s];a?(a.parentNode.removeChild(a),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],s=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,s;return t=this.cssRules(),void 0===(s=e)&&(s={}),t.map(function(e){var t=e[0],a=e[1];return n.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:s.nonce?s.nonce:void 0,dangerouslySetInnerHTML:{__html:a}})})},t.getIdAndRules=function(e){var t=e.children,s=e.dynamic,a=e.id;if(s){var r=m(a,s);return{styleId:r,rules:Array.isArray(t)?t.map(function(e){return h(r,e)}):[h(r,t)]}}return{styleId:m(a),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),g=r.createContext(null);function p(){return new x}function b(){return r.useContext(g)}g.displayName="StyleSheetContext";var y=n.default.useInsertionEffect||n.default.useLayoutEffect,f="undefined"!=typeof window?p():void 0;function j(e){var t=f||b();return t&&("undefined"==typeof window?t.add(e):y(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}j.dynamic=function(e){return e.map(function(e){return m(e[0],e[1])}).join(" ")},s.StyleRegistry=function(e){var t=e.registry,s=e.children,a=r.useContext(g),l=r.useState(function(){return a||t||p()})[0];return n.default.createElement(g.Provider,{value:l},s)},s.createStyleRegistry=p,s.style=j,s.useStyleRegistry=b},37902,(e,t,s)=>{t.exports=e.r(98547).style},78894,20278,73375,63059,55436,39616,87130,3116,28162,e=>{"use strict";e.s(["AlertTriangle",()=>s],78894);var t=e.i(75254);let s=(0,t.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["Target",()=>a],20278);let a=(0,t.default)("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["ChevronLeft",()=>r],73375);let r=(0,t.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronRight",()=>n],63059);let n=(0,t.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["Search",()=>l],55436);let l=(0,t.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Settings",()=>i],39616);let i=(0,t.default)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Filter",()=>d],87130);let d=(0,t.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Clock",()=>o],3116);let o=(0,t.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["default",()=>h],28162);var c=e.i(43476),u=e.i(37902);let m=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")};function h(e){var t,s,a,r;let{open:n,onClose:l,results:i,stats:d,candidates:o=[],onAddManual:h,onEdit:x,onSaveAll:g,onExportCSV:p}=e;return n?(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 fixed inset-0 z-50 overflow-y-auto bg-black/40",children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 min-h-full py-8 px-4",children:(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 mx-auto max-w-6xl bg-white rounded-2xl shadow",children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 p-6 border-b",children:(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 flex items-start justify-between",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53",children:[(0,c.jsx)("h1",{className:"jsx-dbdd04e055976e53 text-2xl font-bold",children:"Bank Statement Analysis"}),(0,c.jsxs)("p",{className:"jsx-dbdd04e055976e53 text-slate-600",children:["Detected subscriptions ",(null==d?void 0:d.windowLabel)?"(".concat(d.windowLabel,")"):""]})]}),(0,c.jsx)("button",{onClick:l,className:"jsx-dbdd04e055976e53 px-3 py-1.5 rounded-lg border hover:bg-gray-50",children:"Close"})]})}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 p-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 stat-card",children:[(0,c.jsx)("h3",{className:"jsx-dbdd04e055976e53 detected text-2xl font-bold",children:null!=(t=null==d?void 0:d.detected)?t:i.length}),(0,c.jsx)("p",{className:"jsx-dbdd04e055976e53",children:"Subscriptions Detected"})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 stat-card",children:[(0,c.jsxs)("h3",{className:"jsx-dbdd04e055976e53 monthly text-2xl font-bold",children:["£",(null!=(s=null==d?void 0:d.monthlyTotal)?s:0).toFixed(2)]}),(0,c.jsx)("p",{className:"jsx-dbdd04e055976e53",children:"Monthly Spending"})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 stat-card",children:[(0,c.jsxs)("h3",{className:"jsx-dbdd04e055976e53 annual text-2xl font-bold",children:["£",(null!=(a=null==d?void 0:d.annualTotal)?a:0).toFixed(2)]}),(0,c.jsx)("p",{className:"jsx-dbdd04e055976e53",children:"Annual Spending"})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 stat-card",children:[(0,c.jsxs)("h3",{className:"jsx-dbdd04e055976e53 confidence text-2xl font-bold",children:[(null!=(r=null==d?void 0:d.avgConfidence)?r:0).toFixed(0),"%"]}),(0,c.jsx)("p",{className:"jsx-dbdd04e055976e53",children:"Average Confidence"})]})]}),(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 p-6 grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map((e,t)=>{var s;return(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 "+(m("subscription-card border-l-4 rounded-xl p-5 shadow-sm hover:shadow transition",(e.category||"other").toLowerCase())||""),children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 subscription-header flex items-start justify-between mb-3",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53",children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 service-name text-lg font-semibold",children:e.name}),(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53 "+(m("category-badge",{software:"badge-software",entertainment:"badge-entertainment",fitness:"badge-fitness",telecom:"badge-telecom",productivity:"badge-productivity",cloud:"badge-cloud",video:"badge-video",music:"badge-music",other:"badge-other"}[(e.category||"other").toLowerCase()]||"badge-other")||""),children:e.category||"Other"})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 text-right",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 cost text-xl font-bold",children:["£",(e.cost||0).toFixed(2)]}),"number"==typeof e.confidence&&(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 "+(m("text-xs mt-0.5",(s=e.confidence)<60?"text-red-600":s<85?"text-amber-600":"text-emerald-700")||""),children:["Confidence: ",Math.round(e.confidence),"%"]})]})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 subscription-details text-sm text-slate-600 space-y-1",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 detail-row flex justify-between",children:[(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53",children:"Frequency:"}),(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53 px-2 py-0.5 rounded bg-slate-100",children:e.frequency||"unknown"})]}),!!e.nextBilling&&(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 detail-row flex justify-between",children:[(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53",children:"Next billing:"}),(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53",children:e.nextBilling})]}),!!e.lastUsed&&(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 detail-row flex justify-between",children:[(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53",children:"Last used:"}),(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53",children:e.lastUsed})]})]}),x&&(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 mt-3",children:(0,c.jsx)("button",{onClick:()=>x(t),className:"jsx-dbdd04e055976e53 px-3 py-1.5 rounded-lg border text-sm hover:bg-gray-50",children:"Review/Edit"})})]},t)})}),o.length>0&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 px-6 pb-2",children:(0,c.jsx)("h2",{className:"jsx-dbdd04e055976e53 text-lg font-bold mb-3",children:"Potentially Missing Subscriptions"})}),(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 px-6 pb-6 grid gap-3",children:o.map((e,t)=>(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 rounded-xl border p-4 flex items-center justify-between bg-slate-50",children:[(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 min-w-0",children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 font-semibold truncate",children:e.name}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 text-sm text-slate-600",children:[e.ref?(0,c.jsx)("span",{className:"jsx-dbdd04e055976e53 mr-2",children:e.ref}):null,"• ",e.frequency||"unknown"," • £",e.amount.toFixed(2)]})]}),h&&(0,c.jsx)("button",{onClick:()=>h(e),className:"jsx-dbdd04e055976e53 px-3 py-1.5 rounded-lg border bg-white text-sm hover:bg-gray-50",children:"Add Manual"})]},t))})]}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 p-6 border-t flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,c.jsx)("div",{className:"jsx-dbdd04e055976e53 text-sm text-slate-600",children:"Review detected subscriptions then save to your account."}),(0,c.jsxs)("div",{className:"jsx-dbdd04e055976e53 flex gap-2",children:[(0,c.jsx)("button",{onClick:g,className:"jsx-dbdd04e055976e53 px-4 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700",children:"Save All Subscriptions"}),(0,c.jsx)("button",{onClick:p,className:"jsx-dbdd04e055976e53 px-4 py-2 rounded-lg border",children:"Export as CSV"}),(0,c.jsx)("button",{onClick:l,className:"jsx-dbdd04e055976e53 px-4 py-2 rounded-lg border",children:"Close"})]})]})]})}),(0,c.jsx)(u.default,{id:"dbdd04e055976e53",children:".stat-card.jsx-dbdd04e055976e53{text-align:center;background:#fff;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,.08)}.detected.jsx-dbdd04e055976e53{color:#059669}.monthly.jsx-dbdd04e055976e53{color:#dc2626}.annual.jsx-dbdd04e055976e53{color:#7c3aed}.confidence.jsx-dbdd04e055976e53{color:#ea580c}.category-badge.jsx-dbdd04e055976e53{border-radius:6px;padding:4px 8px;font-size:12px;font-weight:600;display:inline-block}.badge-software.jsx-dbdd04e055976e53{color:#1d4ed8;background:#dbeafe}.badge-entertainment.jsx-dbdd04e055976e53{color:#dc2626;background:#fee2e2}.badge-fitness.jsx-dbdd04e055976e53{color:#065f46;background:#d1fae5}.badge-telecom.jsx-dbdd04e055976e53{color:#7c2d12;background:#ede9fe}.badge-productivity.jsx-dbdd04e055976e53{color:#92400e;background:#fef3c7}.badge-cloud.jsx-dbdd04e055976e53{color:#155e75;background:#cffafe}.badge-video.jsx-dbdd04e055976e53{color:#be185d;background:#fce7f3}.badge-music.jsx-dbdd04e055976e53{color:#365314;background:#ecfccb}.badge-other.jsx-dbdd04e055976e53{color:#374151;background:#f3f4f6}.software.jsx-dbdd04e055976e53{border-left-color:#3b82f6}.entertainment.jsx-dbdd04e055976e53{border-left-color:#ef4444}.fitness.jsx-dbdd04e055976e53{border-left-color:#10b981}.telecom.jsx-dbdd04e055976e53{border-left-color:#8b5cf6}.productivity.jsx-dbdd04e055976e53{border-left-color:#f59e0b}.cloud.jsx-dbdd04e055976e53{border-left-color:#06b6d4}.video.jsx-dbdd04e055976e53{border-left-color:#ec4899}.music.jsx-dbdd04e055976e53{border-left-color:#84cc16}.other.jsx-dbdd04e055976e53{border-left-color:#6b7280}"})]}):null}},48819,66478,e=>{"use strict";e.s(["default",()=>m,"useEnhancedBudget",()=>o],48819);var t=e.i(43476),s=e.i(71645);e.i(36180);var a=e.i(98925),r=e.i(59141);e.s(["useHouseholdId",()=>l,"useHouseholdMembers",()=>i],66478);var n=e.i(9375);function l(){let[e]=(0,n.useAuthState)(r.auth),[t,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!e)return;let t=(0,a.doc)(r.db,"users",e.uid);(0,a.getDoc)(t).then(e=>{var t;return l(e.exists()&&null!=(t=e.data().householdId)?t:null)})},[e]),t}function i(e){let[t,n]=(0,s.useState)([]);return(0,s.useEffect)(()=>{if(!e)return;let t=(0,a.query)((0,a.collection)(r.db,"households",e,"members")),s=(0,a.onSnapshot)(t,e=>{let t=[];e.forEach(e=>t.push({uid:e.id,...e.data()})),n(t)});return()=>s()},[e]),t}let d=(0,s.createContext)(null),o=()=>{let e=(0,s.useContext)(d);if(!e)throw Error("useEnhancedBudget must be used within HouseholdBudgetProvider");return e},c=e=>"number"==typeof e&&isFinite(e)?e:0,u=e=>{let t={};return Object.entries(e).forEach(e=>{let[s,a]=e;void 0!==a&&("number"==typeof a&&Number.isNaN(a)||(t[s]=a))}),t},m=function(e){let{householdId:n,children:i}=e,o=null==l?void 0:l(),m=null!=n?n:o,[h,x]=(0,s.useState)([]),[g,p]=(0,s.useState)([]),[b,y]=(0,s.useState)([]),[f,j]=(0,s.useState)({}),v=(0,s.useCallback)(e=>{j(t=>{let s=Object.keys(t),a=Object.keys(e);return s.length===a.length&&a.every(s=>t[s]===e[s])?t:e})},[]),N=(0,s.useMemo)(()=>h.map(e=>{var t;return{...e,spent:c(null!=(t=f[e.id])?t:0)}}),[h,f]);(0,s.useEffect)(()=>{if(!m)return;let e=(0,a.collection)(r.db,"households",m,"categories"),t=(0,a.onSnapshot)(e,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,name:s.name||"Category",emoji:s.emoji||"💰",color:s.color||"#6366f1",type:s.type||"essential",monthlyBudget:c(s.monthlyBudget),description:s.description||""})}),x(t)}),s=(0,a.collection)(r.db,"households",m,"transactions"),n=(0,a.onSnapshot)(s,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,title:s.title||"Transaction",amount:c(s.amount),categoryId:s.categoryId||"",date:s.date||new Date().toISOString().slice(0,10),type:s.type||"expense",recurring:s.recurring||"none",notes:s.notes,tags:s.tags,receipts:s.receipts})}),p(t)}),l=(0,a.collection)(r.db,"households",m,"goals"),i=(0,a.onSnapshot)(l,e=>{let t=[];e.forEach(e=>{let s=e.data();t.push({id:e.id,name:s.name||"Goal",target:c(s.target),current:c(s.current),deadline:s.deadline||new Date().toISOString().slice(0,10),emoji:s.emoji||"🏁",color:s.color||"#10b981"})}),y(t)});return()=>{t(),n(),i()}},[m]);let w=async e=>{var t,s,n,l,i;if(!m)throw Error("No householdId");let d=u({name:e.name,emoji:null!=(t=e.emoji)?t:"💰",color:null!=(s=e.color)?s:"#6366f1",type:null!=(n=e.type)?n:"essential",monthlyBudget:c(null!=(l=e.monthlyBudget)?l:0),description:null!=(i=e.description)?i:"",householdId:m,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()});return(await (0,a.addDoc)((0,a.collection)(r.db,"households",m,"categories"),d)).id},k=async(e,t)=>{if(!m)throw Error("No householdId");let{spent:s,...n}=t,l=u({...n,monthlyBudget:null!=n.monthlyBudget?c(n.monthlyBudget):void 0,updatedAt:(0,a.serverTimestamp)()}),i=(0,a.doc)(r.db,"households",m,"categories",e);await (0,a.updateDoc)(i,l)},S=async e=>{if(!m)throw Error("No householdId");await (0,a.deleteDoc)((0,a.doc)(r.db,"households",m,"categories",e))},M=async e=>{if(!m)throw Error("No householdId");let t=u({...e,amount:c(e.amount),householdId:m,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()});return(await (0,a.addDoc)((0,a.collection)(r.db,"households",m,"transactions"),t)).id},C=async(e,t)=>{if(!m)throw Error("No householdId");let s=u({...t,amount:null!=t.amount?c(t.amount):void 0,updatedAt:(0,a.serverTimestamp)()});await (0,a.updateDoc)((0,a.doc)(r.db,"households",m,"transactions",e),s)},B=async e=>{if(!m)throw Error("No householdId");await (0,a.deleteDoc)((0,a.doc)(r.db,"households",m,"transactions",e))},_=async e=>{if(!m)throw Error("No householdId");let t=u({...e,target:c(e.target),current:c(e.current),householdId:m,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()});return(await (0,a.addDoc)((0,a.collection)(r.db,"households",m,"goals"),t)).id},A=async(e,t)=>{if(!m)throw Error("No householdId");let s=u({...t,target:null!=t.target?c(t.target):void 0,current:null!=t.current?c(t.current):void 0,updatedAt:(0,a.serverTimestamp)()});await (0,a.updateDoc)((0,a.doc)(r.db,"households",m,"goals",e),s)},E=async e=>{if(!m)throw Error("No householdId");await (0,a.deleteDoc)((0,a.doc)(r.db,"households",m,"goals",e))};return(0,t.jsx)(d.Provider,{value:{categories:N,transactions:g,goals:b,createCategory:w,updateCategory:k,deleteCategory:S,addTransaction:M,updateTransaction:C,deleteTransaction:B,createGoal:_,updateGoal:A,deleteGoal:E,setDerivedSpentLocal:v},children:i})}},55794,33819,46417,e=>{"use strict";e.s(["default",()=>eq],55794);var t=e.i(43476),s=e.i(71645),a=e.i(87316),r=e.i(12426),n=e.i(78894),l=e.i(20278),i=e.i(73375),d=e.i(63059),o=e.i(55436),c=e.i(69074),u=e.i(39616),m=e.i(78583),h=e.i(87130),x=e.i(3116);e.i(36180);var g=e.i(98925),p=e.i(59141),b=e.i(9375);e.i(51718);var y=e.i(18357),f=e.i(47513),j=e.i(94e3),v=e.i(87410),N=e.i(28162),w=e.i(48819),k=e.i(75254);let S=(0,k.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);(0,k.default)("tags",[["path",{d:"M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z",key:"16rjxf"}],["path",{d:"M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193",key:"178nd4"}],["circle",{cx:"10.5",cy:"6.5",r:".5",fill:"currentColor",key:"12ikhr"}]]);var M=e.i(25652),C=e.i(35408);e.i(63209),e.i(69638),(0,k.default)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),(0,k.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);let B=(0,k.default)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),_=(0,k.default)("chart-pie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),A=(0,k.default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),E=(0,k.default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),F=(0,k.default)("piggy-bank",[["path",{d:"M11 17h3v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-3a3.16 3.16 0 0 0 2-2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1a5 5 0 0 0-2-4V3a4 4 0 0 0-3.2 1.6l-.3.4H11a6 6 0 0 0-6 6v1a5 5 0 0 0 2 4v3a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1z",key:"1piglc"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M2 8v1a2 2 0 0 0 2 2h1",key:"1env43"}]]),D=(0,k.default)("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),T=(0,k.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),R=(0,k.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var I=e.i(43531),O=e.i(70756);let z=(0,k.default)("lock-open",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),U=[10,20,50,100],L=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),q=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2,maximumFractionDigits:2}),P=e=>L.format(Math.round(e||0));function G(){let{categories:e,updateCategory:a,createCategory:r}=(0,w.useEnhancedBudget)(),n=[{name:"Mortgage",emoji:"🏠",type:"essential",monthlyBudget:1200},{name:"Groceries & Food",emoji:"🛒",type:"essential",monthlyBudget:400},{name:"Utilities (Gas/Electric)",emoji:"⚡",type:"essential",monthlyBudget:120},{name:"Internet & Phone",emoji:"📶",type:"essential",monthlyBudget:60},{name:"Transport & Fuel",emoji:"🚗",type:"essential",monthlyBudget:200},{name:"Insurance",emoji:"🛡️",type:"essential",monthlyBudget:85},{name:"Entertainment",emoji:"🎭",type:"lifestyle",monthlyBudget:100},{name:"Investments",emoji:"📈",type:"savings",monthlyBudget:200}];async function l(){try{await Promise.all(n.map(e=>r({name:e.name,emoji:e.emoji,color:"#6366f1",type:e.type,monthlyBudget:e.monthlyBudget,description:e.description||""})))}catch(e){alert((null==e?void 0:e.message)||"Budget isn’t ready yet—try again in a moment.")}}let i=(0,s.useMemo)(()=>e.map(e=>({id:e.id,name:e.name,emoji:e.emoji,type:e.type,monthlyBudget:Number(e.monthlyBudget||0)})),[e]),d=(0,s.useMemo)(()=>{let e={essential:[],lifestyle:[],savings:[],debt:[]};return i.forEach(t=>e[t.type].push(t)),e},[i]),o=(0,s.useMemo)(()=>i.reduce((e,t)=>e+(t.monthlyBudget||0),0),[i]),[c,u]=(0,s.useState)(Math.max(500,Math.round(o)||1e3)),[m,h]=(0,s.useState)({}),[x,g]=(0,s.useState)({}),[p,b]=(0,s.useState)(50),y=(0,s.useMemo)(()=>i.map(e=>"".concat(e.id,":").concat(Math.round(100*(e.monthlyBudget||0)))).sort().join("|"),[i]),f=(0,s.useMemo)(()=>{let e={};return i.forEach(t=>e[t.id]=Math.round(t.monthlyBudget||0)),e},[y]);(0,s.useEffect)(()=>{0===Object.keys(m).length&&i.length&&h(f)},[f,i.length]);let j=(0,s.useMemo)(()=>Object.values(m).reduce((e,t)=>e+(t||0),0),[m]),v=Math.max(0,c-j),N=(0,s.useCallback)((e,t)=>{let s=Math.max(0,c-Object.entries(m).filter(t=>{let[s]=t;return s!==e}).reduce((e,t)=>{let[,s]=t;return e+(s||0)},0));h(a=>({...a,[e]:Math.max(0,Math.min(Math.round(t||0),s))}))},[m,c]),k=(e,t)=>{t>0&&v<t||N(e,(m[e]||0)+t)},S=async()=>{let e=[];for(let t of i){let s=Math.round(100*(m[t.id]||0))/100;s!==(t.monthlyBudget||0)&&e.push(a(t.id,{monthlyBudget:s}))}e.length&&await Promise.all(e)};return((0,s.useEffect)(()=>{let e=e=>{["1","2","3","4"].includes(e.key)&&b(U[Number(e.key)-1]),"ArrowLeft"===e.key&&b(e=>U[Math.max(0,U.indexOf(e)-1)]),"ArrowRight"===e.key&&b(e=>U[Math.min(U.length-1,U.indexOf(e)+1)])};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),e.length)?(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 backdrop-blur border border-gray-100 p-5 space-y-5",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-amber-400 to-yellow-500 grid place-items-center shadow",children:(0,t.jsx)(F,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"Doodle Budget (jars & coins)"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Click coins to fill jars. “Apply” writes targets to Monthly Budget."})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Wallet:"," ",(0,t.jsx)("input",{"aria-label":"Wallet amount",type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm ml-1",value:c,min:0,onChange:e=>u(Math.max(0,Math.round(Number(e.target.value)||0)))})]}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Remaining: ",(0,t.jsx)("span",{className:"font-semibold",children:P(v)})]}),(0,t.jsxs)("button",{onClick:()=>{let e=v;if(e<=0)return;let t=i.filter(e=>!x[e.id]);if(!t.length)return;let s=t.map(e=>{let t=Math.max(0,Math.round(e.monthlyBudget||0)),s=Math.max(0,Math.round(m[e.id]||0));return{id:e.id,gap:Math.max(0,t-s)}}),a=s.reduce((e,t)=>e+t.gap,0);h(r=>{let n={...r};if(0===a){let s=Math.floor(e/t.length);t.forEach(e=>{let t=n[e.id]||0;n[e.id]=t+s}),e-=s*t.length}else s.forEach(t=>{let{id:s,gap:r}=t,l=Math.floor(r/a*e);n[s]=(n[s]||0)+l}),e=0;return n})},className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",title:"Spread remaining across unlocked jars",children:[(0,t.jsx)(R,{className:"w-4 h-4"})," Auto-spread"]}),(0,t.jsxs)("button",{onClick:()=>h(f),className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(T,{className:"w-4 h-4"})," Reset to current"]}),(0,t.jsxs)("button",{onClick:S,disabled:0!==v,className:"px-4 py-2.5 rounded-xl text-sm font-medium inline-flex items-center gap-2 ".concat(0===v?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),title:0===v?"Writes these jar amounts into Monthly Budget":"Allocate the full wallet first",children:[(0,t.jsx)(I.Check,{className:"w-4 h-4"})," Apply to real budget"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Coins:"}),U.map(e=>(0,t.jsxs)("button",{onClick:()=>b(e),className:"px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2 ".concat(p===e?"bg-amber-50 border-amber-300 text-amber-800":"bg-white hover:bg-gray-50"),"aria-pressed":p===e,"aria-label":"Select ".concat(P(e)," coin"),children:[(0,t.jsx)(D,{className:"w-4 h-4"}),P(e)]},e))]}),(0,t.jsx)("div",{className:"space-y-6",children:["essential","lifestyle","savings","debt"].map(e=>{let s=d[e];if(!s.length)return null;let a=s.reduce((e,t)=>e+(m[t.id]||0),0);return(0,t.jsxs)("section",{"aria-label":"".concat(e," jars"),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-700 capitalize",children:e}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Subtotal: ",P(a)]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:s.map(e=>{let s=m[e.id]||0,a=Math.max(0,e.monthlyBudget||0),r=a>0?Math.min(100,s/a*100):0,n=!!x[e.id];return(0,t.jsxs)("div",{className:"rounded-2xl border bg-gradient-to-br from-white to-gray-50 p-4 shadow-[0_1px_0_rgba(0,0,0,0.02)]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("span",{className:"text-xl",children:e.emoji}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,t.jsx)("div",{className:"text-[11px] text-gray-500 truncate",children:a>0?"Target ".concat(q.format(a||0)):"No target set"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{let t;return t=e.id,g(e=>({...e,[t]:!e[t]}))},className:"p-1.5 rounded-lg hover:bg-white/60","aria-label":n?"Unlock jar":"Lock jar",title:n?"Unlock jar":"Lock jar",children:n?(0,t.jsx)(O.Lock,{className:"w-4 h-4 text-gray-700"}):(0,t.jsx)(z,{className:"w-4 h-4 text-gray-500"})}),(0,t.jsx)("div",{className:"text-sm font-semibold",children:P(s)})]})]}),(0,t.jsxs)("div",{className:"h-20 rounded-xl border bg-white overflow-hidden relative mb-3",children:[(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-amber-200/70 transition-[height] duration-300",style:{height:"".concat(r,"%")},"aria-hidden":!0}),(0,t.jsx)("div",{className:"absolute inset-0 grid place-items-center text-[11px] text-gray-600",children:a>0?"".concat(Math.round(r),"%"):P(s)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"inline-flex rounded-lg overflow-hidden border",children:[(0,t.jsxs)("button",{onClick:()=>!n&&k(e.id,-p),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm disabled:opacity-50",disabled:n||s<=0,"aria-label":"Remove ".concat(P(p)," from ").concat(e.name),children:["−",P(p)]}),(0,t.jsxs)("button",{onClick:()=>!n&&k(e.id,p),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm border-l disabled:opacity-50",disabled:n||v<p,title:v<p?"Not enough in wallet":"Add coin","aria-label":"Add ".concat(P(p)," to ").concat(e.name),children:["+",P(p)]})]}),(0,t.jsx)("input",{"aria-label":"".concat(e.name," amount"),type:"number",className:"w-28 px-2 py-1 border rounded-lg text-sm",value:s,min:0,onChange:t=>!n&&N(e.id,Number(t.target.value||0))})]})]},e.id)})})]},e)})}),(0,t.jsxs)("div",{className:"sticky bottom-3 z-10 flex items-center justify-between rounded-xl border bg-white px-4 py-3 shadow",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Wallet ",P(c)," • Allocated ",(0,t.jsx)("span",{className:"font-medium",children:P(j)})," • Remaining"," ",(0,t.jsx)("span",{className:"font-medium",children:P(v)})]}),(0,t.jsx)("button",{onClick:S,disabled:0!==v,className:"px-4 py-2 rounded-xl text-sm font-medium ".concat(0===v?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:"Apply to real budget"})]})]}):(0,t.jsxs)("div",{className:"rounded-2xl border bg-white/90 p-6 text-center",children:[(0,t.jsx)("div",{className:"mx-auto mb-3 h-12 w-12 grid place-items-center rounded-2xl bg-amber-100",children:(0,t.jsx)(F,{className:"w-6 h-6 text-amber-700"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Let’s set up your jars"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Create a few starter categories to begin allocating with coins."}),(0,t.jsx)("button",{onClick:l,className:"mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-gray-900 text-white hover:bg-black",children:"Create starter categories"})]})}let H=(0,k.default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),V=(0,k.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=e=>"£".concat((e||0).toFixed(2)),Y=[{key:"essential",label:"Essentials"},{key:"lifestyle",label:"Lifestyle"},{key:"savings",label:"Savings"},{key:"debt",label:"Debt"}];function J(){let{categories:e,updateCategory:a,deleteCategory:r,createCategory:l}=(0,w.useEnhancedBudget)(),[i,o]=(0,s.useState)({essential:!0,lifestyle:!0,savings:!0,debt:!0}),[c,u]=(0,s.useState)({showOver:!1,showUnused:!1,query:""}),m=(0,s.useMemo)(()=>{let t=e.reduce((e,t)=>e+(t.monthlyBudget||0),0),s=e.reduce((e,t)=>e+(t.spent||0),0);return{totalBudget:t,totalSpent:s,remaining:t-s}},[e]),x=(0,s.useMemo)(()=>{var t;let s=e;if(null==(t=c.query)?void 0:t.trim()){let e=c.query.toLowerCase();s=s.filter(t=>"".concat(t.name," ").concat(t.type).toLowerCase().includes(e))}return c.showOver&&(s=s.filter(e=>(e.spent||0)>(e.monthlyBudget||0))),c.showUnused&&(s=s.filter(e=>0===(e.spent||0))),s},[e,c]),g=(0,s.useMemo)(()=>{let e={essential:[],lifestyle:[],savings:[],debt:[]};return x.forEach(t=>e[t.type].push(t)),e},[x]),p={essential:[{name:"Groceries & Food",emoji:"🛒",hint:"Weekly shop & meal prep",budget:400},{name:"Utilities (Gas/Electric)",emoji:"⚡",hint:"Energy bills",budget:120},{name:"Internet & Phone",emoji:"📶",hint:"Broadband & mobile",budget:60}],lifestyle:[{name:"Dining Out",emoji:"🍽️",hint:"Restaurants & coffee",budget:150},{name:"Subscriptions",emoji:"📺",hint:"Streaming & apps",budget:80}],savings:[{name:"Emergency Fund",emoji:"🆘",hint:"3–6 months buffer",budget:200},{name:"Holiday",emoji:"✈️",hint:"Trips & breaks",budget:100}],debt:[{name:"Credit Card",emoji:"💳",hint:"Monthly payment",budget:150}]};async function b(e,t){var s;await l({name:t.name,emoji:t.emoji,color:"#6366f1",type:e,monthlyBudget:null!=(s=t.budget)?s:0,description:t.hint})}let y=e=>{let{type:l,title:c,items:u}=e,m=u.reduce((e,t)=>e+(t.monthlyBudget||0),0),h=u.reduce((e,t)=>e+(t.spent||0),0),x=m-h;return(0,t.jsxs)("div",{className:"rounded-2xl border bg-white overflow-hidden",children:[(0,t.jsxs)("button",{className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 border-b",onClick:()=>o(e=>({...e,[l]:!e[l]})),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[i[l]?(0,t.jsx)(H,{className:"w-4 h-4"}):(0,t.jsx)(d.ChevronRight,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900",children:c}),(0,t.jsxs)("span",{className:"ml-2 text-xs text-gray-600",children:[W(h)," / ",W(m)," • ",(0,t.jsx)("b",{children:W(x)})," left"]})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Subtotal"})]}),i[l]&&(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"overflow-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"sticky top-0 bg-white z-10",children:(0,t.jsxs)("tr",{className:"text-left",children:[(0,t.jsx)("th",{className:"px-4 py-2 w-8"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Category"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Monthly Budget"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Spent"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Remaining"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Status"}),(0,t.jsx)("th",{className:"px-4 py-2 w-10"})]})}),(0,t.jsxs)("tbody",{children:[u.map(e=>{var l;let i=(e.monthlyBudget||0)-(e.spent||0),d=e.monthlyBudget?Math.min(100,e.spent/e.monthlyBudget*100):0;return(0,t.jsxs)(s.default.Fragment,{children:[(0,t.jsxs)("tr",{className:"border-t align-middle",children:[(0,t.jsx)("td",{className:"px-4 py-2 text-lg",children:e.emoji}),(0,t.jsx)("td",{className:"px-4 py-2",children:(0,t.jsx)(Z,{value:e.name,onSave:t=>a(e.id,{name:t}),sub:e.description})}),(0,t.jsx)("td",{className:"px-4 py-2",children:(0,t.jsx)(Z,{value:String(null!=(l=e.monthlyBudget)?l:0),type:"number",onSave:t=>a(e.id,{monthlyBudget:Number(t||"0")})})}),(0,t.jsx)("td",{className:"px-4 py-2 text-gray-700",children:W(e.spent||0)}),(0,t.jsx)("td",{className:"px-4 py-2",children:W(i)}),(0,t.jsx)("td",{className:"px-4 py-2",children:(e=>{let s=e.monthlyBudget||0,a=e.spent||0;return 0===s&&0===a?(0,t.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-100 text-gray-600",children:"Unbudgeted"}):a<=.75*s?(0,t.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs bg-emerald-100 text-emerald-700",children:"On track"}):a<=s?(0,t.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs bg-amber-100 text-amber-700",children:"Tight"}):(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-rose-100 text-rose-700",children:[(0,t.jsx)(n.AlertTriangle,{className:"w-3 h-3"}),"Over"]})})(e)}),(0,t.jsx)("td",{className:"px-4 py-2 text-right",children:(0,t.jsx)("button",{onClick:()=>r(e.id),className:"p-1 rounded hover:bg-gray-100 text-rose-600",title:"Delete",children:(0,t.jsx)(V,{className:"w-4 h-4"})})})]}),(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-4 pb-3",children:(0,t.jsx)("div",{className:"mt-2 h-2 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gray-900",style:{width:"".concat(d,"%")}})})})})]},e.id)}),(0,t.jsxs)("tr",{className:"border-t bg-gray-50/60",children:[(0,t.jsx)("td",{className:"px-4 py-2"}),(0,t.jsx)("td",{className:"px-4 py-2",colSpan:5,children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Quick add:"}),p[l].map(e=>(0,t.jsxs)("button",{onClick:()=>b(l,e),className:"px-2 py-1 rounded-full border bg-white hover:bg-gray-50",title:e.hint,children:[(0,t.jsx)("span",{className:"mr-1",children:e.emoji}),e.name]},e.name))]})}),(0,t.jsx)("td",{className:"px-4 py-2 text-right",children:(0,t.jsxs)("button",{onClick:()=>b(l,{name:"New category",emoji:"💰",budget:0}),className:"px-2 py-1 rounded-lg border bg-white hover:bg-gray-50 text-sm",children:[(0,t.jsx)(S,{className:"w-4 h-4 inline -mt-0.5 mr-1"}),"Add"]})})]})]}),(0,t.jsx)("tfoot",{className:"sticky bottom-0 bg-white border-t",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-4 py-2"}),(0,t.jsx)("td",{className:"px-4 py-2 text-sm text-gray-600",children:"Section subtotal"}),(0,t.jsx)("td",{className:"px-4 py-2 font-medium",children:W(m)}),(0,t.jsx)("td",{className:"px-4 py-2 font-medium",children:W(h)}),(0,t.jsx)("td",{className:"px-4 py-2 font-medium",children:W(x)}),(0,t.jsx)("td",{className:"px-4 py-2"}),(0,t.jsx)("td",{className:"px-4 py-2"})]})})]})})})]})};return(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 backdrop-blur border border-gray-100 shadow-sm p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"Budget (grouped)"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Filter,{className:"w-4 h-4 absolute left-2 top-2.5 text-gray-400"}),(0,t.jsx)("input",{placeholder:"Search category…",className:"pl-8 pr-3 py-2 bg-gray-50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:c.query,onChange:e=>u(t=>({...t,query:e.target.value}))})]}),(0,t.jsx)(Q,{checked:!!c.showOver,onChange:e=>u(t=>({...t,showOver:e})),label:"Only over-budget"}),(0,t.jsx)(Q,{checked:!!c.showUnused,onChange:e=>u(t=>({...t,showUnused:e})),label:"Only unused"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,t.jsx)(K,{label:"Monthly Budget",value:W(m.totalBudget)}),(0,t.jsx)(K,{label:"Spent",value:W(m.totalSpent)}),(0,t.jsx)(K,{label:"Remaining",value:W(m.remaining)})]}),(0,t.jsx)("div",{className:"space-y-4",children:Y.map(e=>{let s=g[e.key];return(null==s?void 0:s.length)?(0,t.jsx)(y,{type:e.key,title:e.label,items:s},e.key):null})})]})}function Z(e){let{value:a,onSave:r,type:n="text",sub:l}=e,[i,d]=(0,s.useState)(!1),[o,c]=(0,s.useState)(a),u=()=>{d(!1),o!==a&&r(o)};return(0,t.jsx)("div",{children:i?(0,t.jsx)("input",{autoFocus:!0,className:"w-full border rounded px-2 py-1 text-sm",value:o,onChange:e=>c(e.target.value),onBlur:u,onKeyDown:e=>{("Enter"===e.key||"Tab"===e.key)&&u(),"Escape"===e.key&&(c(a),d(!1))},type:n}):(0,t.jsxs)("button",{className:"w-full text-left hover:bg-gray-50 rounded px-1",onClick:()=>d(!0),title:"Click to edit",children:[(0,t.jsx)("div",{className:"font-medium",children:a}),l&&(0,t.jsx)("div",{className:"text-xs text-gray-500 truncate",children:l})]})})}function K(e){let{label:s,value:a}=e;return(0,t.jsxs)("div",{className:"rounded-2xl p-4 bg-gradient-to-r from-gray-900 to-gray-800 text-white",children:[(0,t.jsx)("div",{className:"text-xs/5 opacity-80",children:s}),(0,t.jsx)("div",{className:"text-xl font-bold",children:a})]})}function Q(e){let{checked:s,onChange:a,label:r}=e;return(0,t.jsx)("button",{onClick:()=>a(!s),className:"px-3 py-2 rounded-xl text-sm border ".concat(s?"bg-blue-50 border-blue-200 text-blue-700":"bg-white hover:bg-gray-50"),children:r})}var $=e.i(63488);let X=[10,20,50,100];function ee(){let{categories:e,updateCategory:t}=(0,w.useEnhancedBudget)(),a=(0,s.useMemo)(()=>e.reduce((e,t)=>e+(t.monthlyBudget||0),0),[e]),[r,n]=(0,s.useState)(Math.max(500,Math.round(a)||1e3)),[l,i]=(0,s.useState)({}),[d,o]=(0,s.useState)({}),[c,u]=(0,s.useState)(50),m=(0,s.useMemo)(()=>e.map(e=>"".concat(e.id,":").concat(Math.round(100*(e.monthlyBudget||0)))).sort().join("|"),[e]),h=(0,s.useMemo)(()=>{let t={};return e.forEach(e=>t[e.id]=Math.round(e.monthlyBudget||0)),t},[m,e]);(0,s.useEffect)(()=>{0===Object.keys(l).length&&e.length&&i(h)},[h,e.length]);let x=(0,s.useMemo)(()=>Object.values(l).reduce((e,t)=>e+(t||0),0),[l]),g=Math.max(0,r-x),p=(0,s.useCallback)((e,t)=>{let s=Math.max(0,r-Object.entries(l).filter(t=>{let[s]=t;return s!==e}).reduce((e,t)=>{let[,s]=t;return e+(s||0)},0));i(a=>({...a,[e]:Math.max(0,Math.min(Math.round(t||0),s))}))},[l,r]),b=async()=>{let s=[];for(let a of e){let e=Math.round(100*(l[a.id]||0))/100;e!==(a.monthlyBudget||0)&&s.push(t(a.id,{monthlyBudget:e}))}s.length&&await Promise.all(s)};return{categories:e,wallet:r,setWallet:n,draft:l,setDraft:i,locked:d,toggleLock:e=>o(t=>({...t,[e]:!t[e]})),coin:c,setCoin:u,assigned:x,remaining:g,bump:(e,t)=>{t>0&&g<t||p(e,(l[e]||0)+t)},clampJar:p,autoSpreadRemaining:()=>{if(g<=0)return;let t=e.filter(e=>!d[e.id]);if(!t.length)return;let s=t.map(e=>{let t=Math.max(0,Math.round(e.monthlyBudget||0)),s=Math.max(0,Math.round(l[e.id]||0));return{id:e.id,gap:Math.max(0,t-s)}}),a=s.reduce((e,t)=>e+t.gap,0);i(e=>{let r={...e};if(0===a){let e=Math.floor(g/t.length);t.forEach(t=>r[t.id]=(r[t.id]||0)+e)}else s.forEach(e=>{let{id:t,gap:s}=e,n=Math.floor(s/a*g);r[t]=(r[t]||0)+n});return r})},resetToCurrent:()=>i(h),applyToRealBudget:b}}let et=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),es=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2}),ea=e=>et.format(Math.round(e||0));function er(){let{categories:e,wallet:s,setWallet:a,draft:r,clampJar:n,bump:l,locked:i,toggleLock:d,coin:o,setCoin:c,assigned:u,remaining:m,autoSpreadRemaining:h,resetToCurrent:x,applyToRealBudget:g}=ee();return(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 border border-gray-100 p-5 space-y-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-sky-400 to-blue-500 grid place-items-center shadow",children:(0,t.jsx)($.Mail,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"Envelopes Budget"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Fill each envelope with “notes”. Apply to set monthly targets."})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Wallet:"," ",(0,t.jsx)("input",{type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm ml-1",value:s,min:0,onChange:e=>a(Math.max(0,Math.round(Number(e.target.value)||0)))})]}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Remaining: ",(0,t.jsx)("span",{className:"font-semibold",children:ea(m)})]}),(0,t.jsxs)("button",{onClick:h,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(R,{className:"w-4 h-4"})," Auto-spread"]}),(0,t.jsxs)("button",{onClick:x,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(T,{className:"w-4 h-4"})," Reset"]}),(0,t.jsxs)("button",{onClick:g,disabled:0!==m,className:"px-4 py-2.5 rounded-xl text-sm font-medium inline-flex items-center gap-2 ".concat(0===m?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:[(0,t.jsx)(I.Check,{className:"w-4 h-4"})," Apply"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Notes:"}),X.map(e=>(0,t.jsxs)("button",{onClick:()=>c(e),className:"px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2 ".concat(o===e?"bg-sky-50 border-sky-300 text-sky-800":"bg-white hover:bg-gray-50"),children:[(0,t.jsx)(D,{className:"w-4 h-4"}),ea(e)]},e))]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.map(e=>{let s=r[e.id]||0,a=Math.max(0,e.monthlyBudget||0),l=a>0?Math.min(100,s/a*100):0,c=!!i[e.id];return(0,t.jsxs)("div",{className:"rounded-2xl border bg-gradient-to-br from-white to-gray-50 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("span",{className:"text-xl",children:e.emoji}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,t.jsxs)("div",{className:"text-[11px] text-gray-500 truncate",children:["Target ",a?es.format(a||0):"—"]})]})]}),(0,t.jsx)("button",{onClick:()=>d(e.id),className:"p-1.5 rounded-lg hover:bg-white/60",children:c?(0,t.jsx)(O.Lock,{className:"w-4 h-4 text-gray-700"}):(0,t.jsx)(z,{className:"w-4 h-4 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"h-24 relative rounded-xl border bg-white overflow-hidden mb-3",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-6 bg-gradient-to-b from-gray-200/70 to-transparent"}),(0,t.jsx)("div",{className:"absolute bottom-2 left-2 right-2 flex flex-wrap gap-1",children:Array.from({length:Math.max(1,Math.floor(l/20))}).map((e,s)=>(0,t.jsx)("div",{className:"h-4 flex-1 min-w-[20%] bg-sky-100 border border-sky-200 rounded-sm"},s))}),(0,t.jsx)("div",{className:"absolute inset-0 grid place-items-center text-[11px] text-gray-600",children:a?"".concat(Math.round(l),"%"):ea(s)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"inline-flex rounded-lg overflow-hidden border",children:[(0,t.jsxs)("button",{onClick:()=>!c&&n(e.id,Math.max(0,s-o)),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm disabled:opacity-50",disabled:c||s<=0,children:["−",ea(o)]}),(0,t.jsxs)("button",{onClick:()=>!c&&n(e.id,s+o),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm border-l disabled:opacity-50",disabled:c||m<o,children:["+",ea(o)]})]}),(0,t.jsx)("input",{type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm",value:s,min:0,onChange:t=>!c&&n(e.id,Number(t.target.value||0))})]})]},e.id)})}),(0,t.jsxs)("div",{className:"sticky bottom-3 z-10 flex items-center justify-between rounded-xl border bg-white px-4 py-3 shadow",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Wallet ",ea(s)," • Allocated ",(0,t.jsx)("span",{className:"font-medium",children:ea(u)})," • Remaining"," ",(0,t.jsx)("span",{className:"font-medium",children:ea(m)})]}),(0,t.jsx)("button",{onClick:g,disabled:0!==m,className:"px-4 py-2 rounded-xl text-sm font-medium ".concat(0===m?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:"Apply"})]})]})}let en=(0,k.default)("leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]),el=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),ei=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2}),ed=e=>el.format(Math.round(e||0));function eo(){let{categories:e,wallet:s,setWallet:a,draft:r,clampJar:n,bump:l,locked:i,toggleLock:d,coin:o,setCoin:c,assigned:u,remaining:m,autoSpreadRemaining:h,resetToCurrent:x,applyToRealBudget:g}=ee();return(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 border border-gray-100 p-5 space-y-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-emerald-400 to-lime-500 grid place-items-center shadow",children:(0,t.jsx)(en,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"Plants Budget"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Grow each pot with coins. Apply to set monthly targets."})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Wallet:"," ",(0,t.jsx)("input",{type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm ml-1",value:s,min:0,onChange:e=>a(Math.max(0,Math.round(Number(e.target.value)||0)))})]}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Remaining: ",(0,t.jsx)("span",{className:"font-semibold",children:ed(m)})]}),(0,t.jsxs)("button",{onClick:h,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(R,{className:"w-4 h-4"})," Auto-spread"]}),(0,t.jsxs)("button",{onClick:x,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(T,{className:"w-4 h-4"})," Reset"]}),(0,t.jsxs)("button",{onClick:g,disabled:0!==m,className:"px-4 py-2.5 rounded-xl text-sm font-medium inline-flex items-center gap-2 ".concat(0===m?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:[(0,t.jsx)(I.Check,{className:"w-4 h-4"})," Apply"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Coins:"}),X.map(e=>(0,t.jsxs)("button",{onClick:()=>c(e),className:"px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2 ".concat(o===e?"bg-emerald-50 border-emerald-300 text-emerald-800":"bg-white hover:bg-gray-50"),children:[(0,t.jsx)(D,{className:"w-4 h-4"}),ed(e)]},e))]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:e.map(e=>{let s=r[e.id]||0,a=Math.max(0,e.monthlyBudget||0),l=a>0?Math.min(100,s/a*100):0,c=!!i[e.id];return(0,t.jsxs)("div",{className:"rounded-2xl border bg-gradient-to-br from-white to-gray-50 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("span",{className:"text-xl",children:e.emoji}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,t.jsxs)("div",{className:"text-[11px] text-gray-500 truncate",children:["Target ",a?ei.format(a||0):"—"]})]})]}),(0,t.jsx)("button",{onClick:()=>d(e.id),className:"p-1.5 rounded-lg hover:bg-white/60",children:c?(0,t.jsx)(O.Lock,{className:"w-4 h-4 text-gray-700"}):(0,t.jsx)(z,{className:"w-4 h-4 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"h-24 relative rounded-xl border bg-gradient-to-b from-emerald-50 to-white overflow-hidden mb-3",children:[(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-6 bg-amber-200/70 border-t border-amber-300"}),(0,t.jsx)("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 w-1.5 bg-emerald-500 origin-bottom transition-[height] duration-300",style:{height:"".concat(Math.max(4,l),"%")}}),(0,t.jsx)("div",{className:"absolute bottom-[calc(6px+50%)] left-1/2 -translate-x-1/2",children:(0,t.jsx)(en,{className:"w-4 h-4 text-emerald-600"})}),(0,t.jsx)("div",{className:"absolute inset-0 grid place-items-center text-[11px] text-gray-600",children:a?"".concat(Math.round(l),"%"):ed(s)})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"inline-flex rounded-lg overflow-hidden border",children:[(0,t.jsxs)("button",{onClick:()=>!c&&n(e.id,Math.max(0,s-o)),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm disabled:opacity-50",disabled:c||s<=0,children:["−",ed(o)]}),(0,t.jsxs)("button",{onClick:()=>!c&&n(e.id,s+o),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm border-l disabled:opacity-50",disabled:c||m<o,children:["+",ed(o)]})]}),(0,t.jsx)("input",{type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm",value:s,min:0,onChange:t=>!c&&n(e.id,Number(t.target.value||0))})]})]},e.id)})}),(0,t.jsxs)("div",{className:"sticky bottom-3 z-10 flex items-center justify-between rounded-xl border bg-white px-4 py-3 shadow",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Wallet ",ed(s)," • Allocated ",(0,t.jsx)("span",{className:"font-medium",children:ed(u)})," • Remaining"," ",(0,t.jsx)("span",{className:"font-medium",children:ed(m)})]}),(0,t.jsx)("button",{onClick:g,disabled:0!==m,className:"px-4 py-2 rounded-xl text-sm font-medium ".concat(0===m?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:"Apply"})]})]})}var ec=e.i(61911),eu=e.i(66478);let em=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),eh=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:2}),ex=e=>em.format(Math.round(e||0));function eg(){var e;let{categories:a}=(0,w.useEnhancedBudget)(),r=ee(),{wallet:n,setWallet:l,remaining:i,assigned:d,draft:o,setDraft:c,locked:u,toggleLock:m,coin:h,setCoin:x,clampJar:g,autoSpreadRemaining:p,resetToCurrent:b,applyToRealBudget:y}=r,f=(0,eu.useHouseholdId)(),j=(0,eu.useHouseholdMembers)(f),v=(0,s.useMemo)(()=>j.length?j.map(e=>({id:e.uid,name:e.displayName||"Member",color:e.color||"#0ea5e9",emoji:e.emoji||"👤"})):[{id:"solo",name:"You",color:"#0ea5e9",emoji:"🟦"}],[j]),[N,k]=(0,s.useState)((null==(e=v[0])?void 0:e.id)||"solo");(0,s.useEffect)(()=>{if(!v.find(e=>e.id===N)){var e;k((null==(e=v[0])?void 0:e.id)||"solo")}},[v,N]);let S=(0,s.useMemo)(()=>{let e={};return v.forEach(t=>e[t.id]={}),a.forEach(t=>{let s=Math.floor(Math.round(t.monthlyBudget||0)/Math.max(1,v.length));v.forEach(a=>e[a.id][t.id]=s)}),e},[v.map(e=>e.id).join("|"),a.map(e=>"".concat(e.id,":").concat(e.monthlyBudget)).join("|")]),[M,C]=(0,s.useState)(S);(0,s.useEffect)(()=>C(S),[S]);let B=(0,s.useMemo)(()=>{let e={};for(let t of a)e[t.id]=v.reduce((e,s)=>{var a;return e+((null==(a=M[s.id])?void 0:a[t.id])||0)},0);return e},[M,v,a]);(0,s.useEffect)(()=>{c(B)},[B,c]),v.find(e=>e.id===N);let _=(e,t,s)=>{C(a=>{var n;let l=Math.max(0,((null==(n=a[e])?void 0:n[t])||0)+s),i=v.reduce((s,r)=>{var n;return s+(r.id===e?l:(null==(n=a[r.id])?void 0:n[t])||0)},0);g(t,i);let d=Math.max(0,(r.draft[t]||0)-v.reduce((s,r)=>{var n;return r.id===e?s:s+((null==(n=a[r.id])?void 0:n[t])||0)},0));return{...a,[e]:{...a[e]||{},[t]:d}}})},A=(e,s)=>(0,t.jsxs)("button",{onClick:()=>k(e.id),className:"px-2.5 py-1.5 rounded-xl border text-sm inline-flex items-center gap-2",style:{borderColor:s?e.color:"#e5e7eb",background:s?"".concat(e.color,"22"):"white",color:s?"#111827":"#374151"},title:e.name,children:[(0,t.jsx)("span",{className:"text-lg",children:e.emoji||"👤"}),e.name]},e.id);return(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 border border-gray-100 p-5 space-y-5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-2xl bg-gradient-to-br from-fuchsia-500 to-purple-600 grid place-items-center shadow",children:(0,t.jsx)(ec.Users,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:"Team Budget"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Each person funds categories; the sum becomes your monthly targets."})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,t.jsx)("div",{className:"hidden sm:flex items-center gap-2 mr-2",children:v.map(e=>A(e,e.id===N))}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Wallet:"," ",(0,t.jsx)("input",{type:"number",className:"w-24 px-2 py-1 border rounded-lg text-sm ml-1",value:n,min:0,onChange:e=>l(Math.max(0,Math.round(Number(e.target.value)||0)))})]}),(0,t.jsxs)("div",{className:"px-3 py-2 rounded-xl border bg-white text-sm",children:["Remaining: ",(0,t.jsx)("span",{className:"font-semibold",children:ex(i)})]}),(0,t.jsxs)("button",{onClick:p,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",title:"Fill gaps proportionally to targets",children:[(0,t.jsx)(R,{className:"w-4 h-4"})," Auto-spread"]}),(0,t.jsxs)("button",{onClick:b,className:"px-3 py-2 rounded-xl border bg-white hover:bg-gray-50 text-sm inline-flex items-center gap-2",children:[(0,t.jsx)(T,{className:"w-4 h-4"})," Reset"]}),(0,t.jsxs)("button",{onClick:y,disabled:0!==i,className:"px-4 py-2.5 rounded-xl text-sm font-medium inline-flex items-center gap-2 ".concat(0===i?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:[(0,t.jsx)(I.Check,{className:"w-4 h-4"})," Apply"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-600",children:"Coins:"}),X.map(e=>(0,t.jsxs)("button",{onClick:()=>x(e),className:"px-3 py-2 rounded-xl text-sm border inline-flex items-center gap-2 ".concat(h===e?"bg-fuchsia-50 border-fuchsia-300 text-fuchsia-800":"bg-white hover:bg-gray-50"),children:[(0,t.jsx)(D,{className:"w-4 h-4"}),ex(e)]},e)),(0,t.jsx)("div",{className:"sm:hidden ml-auto inline-flex gap-1",children:v.map(e=>A(e,e.id===N))})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:a.map(e=>{var s;let a=o[e.id]||0,n=Math.max(0,e.monthlyBudget||0),l=n>0?Math.min(100,a/n*100):0,d=!!u[e.id];return(0,t.jsxs)("div",{className:"rounded-2xl border bg-gradient-to-br from-white to-gray-50 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("span",{className:"text-xl",children:e.emoji}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900 truncate",children:e.name}),(0,t.jsxs)("div",{className:"text-[11px] text-gray-500 truncate",children:["Target ",n?eh.format(n||0):"—"]})]})]}),(0,t.jsx)("button",{onClick:()=>m(e.id),className:"p-1.5 rounded-lg hover:bg-white/60",children:d?(0,t.jsx)(O.Lock,{className:"w-4 h-4 text-gray-700"}):(0,t.jsx)(z,{className:"w-4 h-4 text-gray-500"})})]}),(0,t.jsxs)("div",{className:"h-4 w-full rounded-full bg-white border overflow-hidden mb-3 relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 bg-gray-200",style:{width:"".concat(Math.min(100,l),"%")}}),(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 flex",children:v.map(s=>{var a;let r=(null==(a=M[s.id])?void 0:a[e.id])||0,l=n?Math.min(100,r/n*100):0;return(0,t.jsx)("div",{title:"".concat(s.name,": ").concat(ex(r)),style:{width:"".concat(l,"%"),background:s.color}},s.id)})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{className:"inline-flex rounded-lg overflow-hidden border",children:[(0,t.jsxs)("button",{onClick:()=>!d&&_(N,e.id,-h),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm disabled:opacity-50",disabled:d||0>=((null==(s=M[N])?void 0:s[e.id])||0),children:["−",ex(h)]}),(0,t.jsxs)("button",{onClick:()=>!d&&_(N,e.id,h),className:"px-3 py-1.5 bg-white hover:bg-gray-50 text-sm border-l disabled:opacity-50",disabled:d||i<h,children:["+",ex(h)]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:v.map(s=>{var a,n;return(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-xs",title:s.name,children:null!=(n=s.emoji)?n:"👤"}),(0,t.jsx)("input",{type:"number",className:"w-20 px-2 py-1 border rounded-lg text-sm",value:(null==(a=M[s.id])?void 0:a[e.id])||0,min:0,onChange:t=>!d&&((e,t,s)=>{let a=Math.max(0,Math.round(Number(s)||0));C(s=>{let n=v.reduce((a,r)=>{var n;return r.id===e?a:a+((null==(n=s[r.id])?void 0:n[t])||0)},0);g(t,n+a);let l=Math.max(0,(r.draft[t]||0)-n);return{...s,[e]:{...s[e]||{},[t]:l}}})})(s.id,e.id,Number(t.target.value||0)),style:{borderColor:s.color}})]},s.id)})})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-600 flex justify-between",children:[(0,t.jsxs)("span",{children:["Total: ",(0,t.jsx)("b",{children:ex(a)})]}),(0,t.jsx)("span",{children:n?"".concat(Math.round(l),"% of target"):"No target set"})]})]},e.id)})}),(0,t.jsxs)("div",{className:"sticky bottom-3 z-10 flex items-center justify-between rounded-xl border bg-white px-4 py-3 shadow",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Wallet ",ex(n)," • Allocated ",(0,t.jsx)("span",{className:"font-medium",children:ex(d)})," • Remaining"," ",(0,t.jsx)("span",{className:"font-medium",children:ex(i)})]}),(0,t.jsx)("button",{onClick:y,disabled:0!==i,className:"px-4 py-2 rounded-xl text-sm font-medium ".concat(0===i?"bg-gray-900 text-white hover:bg-black":"bg-gray-200 text-gray-600 cursor-not-allowed"),children:"Apply"})]})]})}let ep=e=>{let{title:s,icon:a,action:r,className:n="",children:l}=e;return(0,t.jsxs)("div",{className:"rounded-2xl bg-white/90 backdrop-blur border border-gray-100 shadow-[0_1px_0_rgba(0,0,0,0.02)] p-5 ".concat(n),children:[(0,t.jsxs)("header",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5 text-gray-900 font-semibold",children:[a&&(0,t.jsx)("span",{className:"text-gray-700",children:a}),(0,t.jsx)("span",{children:s})]}),r]}),l]})},eb=e=>{let{children:s,className:a="",...r}=e;return(0,t.jsx)("button",{...r,className:"inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-gray-900 text-white text-sm font-medium hover:bg-black disabled:opacity-50 transition-colors ".concat(a),children:s})};function ey(){let{categories:e,goals:a}=(0,w.useEnhancedBudget)(),r=(0,s.useMemo)(()=>{let t=e.reduce((e,t)=>e+(t.monthlyBudget||0),0),s=e.reduce((e,t)=>e+(t.spent||0),0),a=e.filter(e=>"essential"===e.type);return{totalBudget:t,totalSpent:s,remaining:t-s,essentialSpent:a.reduce((e,t)=>e+(t.spent||0),0),essentialBudget:a.reduce((e,t)=>e+(t.monthlyBudget||0),0)}},[e]),n=e=>"£".concat((e||0).toFixed(2));return(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Monthly Budget"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:n(r.totalBudget)}),(0,t.jsxs)("p",{className:"text-xs opacity-75",children:[e.length," categories"]})]}),(0,t.jsx)(B,{className:"w-8 h-8 opacity-90"})]})}),(0,t.jsx)("div",{className:"rounded-2xl p-5 text-white ".concat(r.remaining>=0?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-red-500 to-red-600"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Remaining"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:n(r.remaining)}),(0,t.jsxs)("p",{className:"text-xs opacity-75",children:[r.totalBudget?((1-r.totalSpent/r.totalBudget)*100).toFixed(1):"0.0","% left"]})]}),r.remaining>=0?(0,t.jsx)(M.TrendingUp,{className:"w-8 h-8 opacity-90"}):(0,t.jsx)(C.TrendingDown,{className:"w-8 h-8 opacity-90"})]})}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Essential Expenses"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:n(r.essentialSpent)}),(0,t.jsxs)("p",{className:"text-xs opacity-75",children:[r.essentialBudget?(r.essentialSpent/r.essentialBudget*100).toFixed(1):"0.0","% of essential budget"]})]}),(0,t.jsx)(A,{className:"w-8 h-8 opacity-90"})]})}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Savings Goals"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:a.length}),(0,t.jsxs)("p",{className:"text-xs opacity-75",children:[n(a.reduce((e,t)=>e+(t.current||0),0))," saved"]})]}),(0,t.jsx)(_,{className:"w-8 h-8 opacity-90"})]})})]})}function ef(){let{categories:e,addTransaction:a}=(0,w.useEnhancedBudget)(),[r,n]=(0,s.useState)({title:"",amount:"",categoryId:"",date:new Date().toISOString().slice(0,10),notes:""}),l=async e=>{e.preventDefault(),r.title&&r.amount&&r.categoryId&&(await a({title:r.title,amount:Number(r.amount),categoryId:r.categoryId,date:r.date,type:"expense",notes:r.notes,recurring:"none"}),n({title:"",amount:"",categoryId:"",date:new Date().toISOString().slice(0,10),notes:""}))};return(0,t.jsx)(ep,{title:"Quick Expense Entry",icon:(0,t.jsx)(E,{className:"w-5 h-5"}),children:(0,t.jsxs)("form",{onSubmit:l,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)("input",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",placeholder:"What did you buy?",value:r.title,onChange:e=>n(t=>({...t,title:e.target.value})),required:!0}),(0,t.jsx)("input",{type:"number",step:"0.01",className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",placeholder:"£0.00",value:r.amount,onChange:e=>n(t=>({...t,amount:e.target.value})),required:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsxs)("select",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",value:r.categoryId,onChange:e=>n(t=>({...t,categoryId:e.target.value})),required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select category"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.emoji," ",e.name]},e.id))]}),(0,t.jsx)("input",{type:"date",className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",value:r.date,onChange:e=>n(t=>({...t,date:e.target.value}))})]}),(0,t.jsx)("input",{className:"w-full px-3 py-2 rounded-xl border border-gray-200 text-sm",placeholder:"Notes (optional)",value:r.notes,onChange:e=>n(t=>({...t,notes:e.target.value}))}),(0,t.jsxs)(eb,{type:"submit",className:"w-full",children:[(0,t.jsx)(S,{className:"w-4 h-4"}),"Add Expense"]})]})})}function ej(){let{goals:e}=(0,w.useEnhancedBudget)(),s=e=>"£".concat(e.toLocaleString());return(0,t.jsx)(ep,{title:"Savings Goals",icon:(0,t.jsx)(_,{className:"w-5 h-5"}),children:(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>{let a=e.target?e.current/e.target*100:0,r=Math.max(0,e.target-e.current),n=Math.ceil((new Date(e.deadline).getTime()-Date.now())/2592e6),l=n>0?r/n:r;return(0,t.jsxs)("div",{className:"p-4 rounded-xl border border-gray-200 bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xl",children:e.emoji}),(0,t.jsx)("h4",{className:"font-semibold text-gray-900",children:e.name})]}),(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-600",children:[a.toFixed(1),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-white rounded-full h-3 mb-3 overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 transition-all duration-500",style:{width:"".concat(Math.min(a,100),"%")}})}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,t.jsxs)("span",{children:[s(e.current)," saved"]}),(0,t.jsxs)("span",{children:[s(e.target)," target"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[(0,t.jsxs)("span",{children:[s(r)," remaining"]}),(0,t.jsxs)("span",{children:[s(l),"/month needed"]})]})]},e.id)})})})}function ev(){let{categories:e,createCategory:a,updateCategory:r}=(0,w.useEnhancedBudget)(),[n,l]=(0,s.useState)("250000"),[i,d]=(0,s.useState)("4.5"),[o,c]=(0,s.useState)("25"),[u,h]=(0,s.useState)("0"),x=(0,s.useMemo)(()=>{let e=Number(n)||0,t=(Number(i)||0)/100/12,s=12*(Number(o)||0);if(e<=0||t<=0||s<=0)return{monthly:0,interest:0,total:0};let a=e*t/(1-Math.pow(1+t,-s))+(Number(u)||0),r=a*s;return{monthly:a,interest:r-e,total:r}},[n,i,o,u]);async function g(){let t=Number(x.monthly.toFixed(2)),s=e.find(e=>"Mortgage"===e.name);s?await r(s.id,{monthlyBudget:t,type:"essential",emoji:"🏠",color:"#0ea5e9"}):await a({name:"Mortgage",emoji:"🏠",color:"#0ea5e9",type:"essential",monthlyBudget:t,description:"Home loan payment"})}return(0,t.jsxs)(ep,{title:"Mortgage (simple)",icon:(0,t.jsx)(m.FileText,{className:"w-5 h-5"}),children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-3 mb-4",children:[(0,t.jsx)("input",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",type:"number",min:0,placeholder:"Amount",value:n,onChange:e=>l(e.target.value)}),(0,t.jsx)("input",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",type:"number",step:"0.01",min:0,placeholder:"APR %",value:i,onChange:e=>d(e.target.value)}),(0,t.jsx)("input",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",type:"number",min:1,placeholder:"Years",value:o,onChange:e=>c(e.target.value)}),(0,t.jsx)("input",{className:"px-3 py-2 rounded-xl border border-gray-200 text-sm",type:"number",min:0,placeholder:"Overpay (opt.)",value:u,onChange:e=>h(e.target.value)}),(0,t.jsx)(eb,{onClick:g,className:"w-full",children:"Add to Budget"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-blue-50 border border-blue-100 p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Monthly payment"}),(0,t.jsxs)("div",{className:"text-xl font-semibold",children:["£",x.monthly.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-amber-50 border border-amber-100 p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total interest"}),(0,t.jsxs)("div",{className:"text-xl font-semibold",children:["£",x.interest.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-emerald-50 border border-emerald-100 p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total paid"}),(0,t.jsxs)("div",{className:"text-xl font-semibold",children:["£",x.total.toFixed(2)]})]})]})]})}function eN(){let[e,a]=(0,s.useState)("budget");return(0,t.jsxs)("div",{className:"space-y-4",id:"budget",children:[(0,t.jsxs)("div",{className:"inline-flex rounded-xl border bg-white overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>a("budget"),className:"px-4 py-2 text-sm ".concat("budget"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Budget"}),(0,t.jsx)("button",{onClick:()=>a("mortgage"),className:"px-4 py-2 text-sm border-l ".concat("mortgage"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Mortgage"}),(0,t.jsx)("button",{onClick:()=>a("doodle"),className:"px-4 py-2 text-sm border-l ".concat("doodle"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Doodle"}),(0,t.jsx)("button",{onClick:()=>a("envelopes"),className:"px-4 py-2 text-sm border-l ".concat("envelopes"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Envelopes"}),(0,t.jsx)("button",{onClick:()=>a("plants"),className:"px-4 py-2 text-sm border-l ".concat("plants"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Plants"}),(0,t.jsx)("button",{onClick:()=>a("team"),className:"px-4 py-2 text-sm border-l ".concat("team"===e?"bg-gray-900 text-white":"hover:bg-gray-50"),children:"Team"})]}),"budget"===e&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(ey,{}),(0,t.jsx)(J,{}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(ef,{})}),(0,t.jsx)("div",{children:(0,t.jsx)(ej,{})})]})]}),"mortgage"===e&&(0,t.jsx)(ev,{}),"doodle"===e&&(0,t.jsx)(G,{}),"envelopes"===e&&(0,t.jsx)(er,{}),"plants"===e&&(0,t.jsx)(eo,{}),"team"===e&&(0,t.jsx)(eg,{})]})}let ew=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ek=e=>e.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),eS=(e,t)=>new Date(e,t+1,0).getDate(),eM=e=>"£".concat((e||0).toFixed(2)),eC=(e,t,s)=>Math.max(t,Math.min(s,e)),eB={Entertainment:"entertainment",Software:"software",Fitness:"fitness","Cloud Storage":"software",News:"entertainment",Music:"entertainment",Video:"entertainment",Gaming:"entertainment",Productivity:"software",Telecom:"utilities",Transport:"transport",Food:"food",Shopping:"other",Finance:"other"},e_={Netflix:"📺",Spotify:"🎵","Amazon Prime":"📦","Disney+":"🏰",Apple:"🍎",Microsoft:"💻",Adobe:"🎨",Google:"🔍",Zoom:"📹","Virgin Active":"💪",PureGym:"🏋️",Three:"📱",EE:"📱",O2:"📱",Vodafone:"📱",LinkedIn:"💼",Skillshare:"🎓",Duolingo:"🗣️",HelloFresh:"🥗","Uber Eats":"🍔",Deliveroo:"🚚"},eA=e=>Math.round(100*e)/100;function eE(e){let{subs:t,planned:a}=e,{categories:r,setDerivedSpentLocal:n}=(0,w.useEnhancedBudget)(),l=(0,s.useMemo)(()=>{let e=new Map;return[...t,...a].forEach(t=>{let s=(e=>{switch(e){case"housing":return"Mortgage";case"utilities":return"Utilities (Gas/Electric)";case"food":return"Groceries & Food";case"transport":return"Transport & Fuel";case"insurance":return"Insurance";case"savings":return"Investments";case"entertainment":case"streaming":return"Entertainment";case"software":return"Productivity";case"fitness":return"Fitness";default:return"Other"}})(t.category);e.set(s,Math.round(((e.get(s)||0)+(t.cost||0))*100)/100)}),e},[t,a]),i=(0,s.useMemo)(()=>Array.from(l.entries()).sort((e,t)=>{let[s]=e,[a]=t;return s.localeCompare(a)}).map(e=>{let[t,s]=e;return"".concat(t,":").concat(s)}).join("|"),[l]),d=(0,s.useMemo)(()=>r.map(e=>"".concat(e.id,":").concat(e.name)).sort().join("|"),[r]);(0,s.useEffect)(()=>{let e={};for(let[t,s]of l){let a=r.find(e=>e.name===t);a&&(e[a.id]=s)}let t=new Set(Array.from(l.keys()));for(let s of r)t.has(s.name)||(e[s.id]=0);n(e)},[i,d]);let o=(0,s.useMemo)(()=>{let e={},t=new Set(Array.from(l.keys()));for(let[t,s]of l){let a=r.find(e=>e.name===t);a&&(e[a.id]=s)}for(let s of r)t.has(s.name)||(e[s.id]=0);return e},[i,d,r,l]),c=(0,s.useMemo)(()=>Object.entries(o).sort((e,t)=>{let[s]=e,[a]=t;return s.localeCompare(a)}).map(e=>{let[t,s]=e;return"".concat(t,":").concat(s)}).join("|"),[o]),u=s.default.useRef("");return(0,s.useEffect)(()=>{u.current!==c&&(n(o),u.current=c)},[c,o,n]),null}function eF(e,t){let s;return!!e.pausedUntil&&(s=new Date(e.pausedUntil),s.getFullYear()===t.getFullYear()&&s.getMonth()===t.getMonth())}async function eD(e){window.pdfjsLib||(await new Promise((e,t)=>{let s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",s.onload=()=>e(),s.onerror=()=>t(Error("Failed to load pdf.js")),document.head.appendChild(s)}),window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");let t=await e.arrayBuffer(),s=await window.pdfjsLib.getDocument({data:t}).promise,a="";for(let e=1;e<=s.numPages;e++){let t=await s.getPage(e),r=(await t.getTextContent()).items.map(e=>(e.str||"")+(e.hasEOL?"\n":" ")).join("").replace(/[ \t]+\n/g,"\n").replace(/\n{3,}/g,"\n\n");a+="\n--- Page ".concat(e," ---\n").concat(r,"\n")}return a}let eT=e=>{let t=e.length,s=e.reduce((e,t)=>{let s=Number(t.cost||0),a=String(t.frequency||"monthly");return"annual"===a?e+s/12:"weekly"===a?e+4.33*s:e+s},0);return{detected:t,monthlyTotal:s,annualTotal:e.filter(e=>"annual"===(e.frequency||"").toLowerCase()).reduce((e,t)=>e+Number(t.cost||0),0),avgConfidence:e.reduce((e,t)=>{var s;return e+Number(null!=(s=t.confidence)?s:85)},0)/Math.max(1,e.length)}},eR=e=>e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),eI=e=>{if(!e)return null;let t=new Date(e);return isNaN(t.getTime())?null:t};function eO(e){let t=[];for(let s of e){let e=eI(s.lastUsed),a=eI(s.nextBilling),r=eI(s.signUpDate);e&&t.push(e),a&&t.push(a),r&&t.push(r)}if(t.length<1)return;let s=new Date(Math.min(...t.map(e=>e.getTime()))),a=new Date(Math.max(...t.map(e=>e.getTime())));return s.getTime()===a.getTime()?eR(s):"".concat(eR(s)," – ").concat(eR(a))}let ez=/(\d{1,3}(?:,\d{3})*(?:\.\d{2})|\d+(?:\.\d{2}))/,eU=e=>ez.test(e);function eL(e,t){let s=new Set(t.map(e=>e.name.toLowerCase())),a=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),r=[/premium/i,/membership/i,/subscribe/i,/subscription/i,/auto-?renew/i,/direct\s*debit|\bDD\b/i,/annual/i,/ renewal/i,/plan\b/i],n=[];for(let e of a){if(!eU(e)||!r.some(t=>t.test(e)))continue;let t=function(e){let t=e.match(ez);if(!t)return null;let s=Number(t[1].replace(/,/g,"")),a=e.slice(0,t.index).trim();return{name:a=(a=a.replace(/^(\d{1,2}[\-\/ ][A-Za-z]{3}|\d{1,2}[\-\/]\d{1,2}[\-\/]\d{2,4})\s+/,"")).replace(/\bPOS\b|\bCARD\b|\bDD\b|\bDIRECT\s+DEBIT\b|\bVISA\b|\bMASTERCARD\b/gi,"").trim(),amount:s}}(e);if(!t)continue;let a=t.name.toLowerCase();if(!a||s.has(a)||a.length<3)continue;let l="unknown";/annual/i.test(e)||/\byr\b|\bye?a?r/i.test(e)?l="annual":/monthly|per\s*month|\/\s*m(o|th)/i.test(e)?l="monthly":/\bweekly|\bper\s*week|\/\s*w(k|eek)/i.test(e)&&(l="weekly");let i=e.length>120?e.slice(0,120)+"…":e;n.push({name:t.name,ref:i,amount:t.amount,frequency:l})}let l=new Map;return n.forEach(e=>{let t="".concat(e.name.toLowerCase(),"__").concat(e.amount.toFixed(2));l.has(t)||l.set(t,e)}),Array.from(l.values()).filter(e=>!Array.from(s).some(t=>t.includes(e.name.toLowerCase())||e.name.toLowerCase().includes(t))).slice(0,25)}function eq(){let[e,k]=(0,b.useAuthState)(p.auth);(0,s.useEffect)(()=>{k||e||(0,y.signInAnonymously)(p.auth).catch(()=>{})},[e,k]);let[S,M]=(0,s.useState)(()=>new Date),[C,B]=(0,s.useState)(""),[_,A]=(0,s.useState)("all"),[E,F]=(0,s.useState)(null),[D,T]=(0,s.useState)(1200),[R,I]=(0,s.useState)(!1),[O,z]=(0,s.useState)(!1),[U,L]=(0,s.useState)(null),q=(e,t)=>{L({type:e,msg:t}),setTimeout(()=>L(null),3500)},[P,G]=(0,s.useState)(!1),[H,V]=(0,s.useState)([]),[W,Y]=(0,s.useState)(),[J,Z]=(0,s.useState)([]),[K,Q]=(0,s.useState)(null),[$,X]=(0,s.useState)({name:"",amount:"",freq:"once"}),[ee,et]=(0,s.useState)(!1),[es,ea]=(0,s.useState)(["Travel","Side Hustle"]),[er,en]=(0,s.useState)(""),el=async e=>{let{valid:t,error:s}=f.ValidationUtils.validateFileUpload(e);if(!t)return void q("error",s||"Invalid file");z(!0);try{let t;if("application/pdf"===e.type){t=await eD(e);let s=(function(e){let t=e=>/^\s*\d{1,2}(?:st|nd|rd|th)?\s+[A-Za-z]{3}\b/.test(e)||/\b\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}\b/.test(e),s=e=>/\d{1,3}(?:,\d{3})*(?:\.\d{2})$/.test(e),a=e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),r=[],n="";for(let e=0;e<a.length;e++){let l=a[e],i=a[e+1]||"",d=a[e+2]||"";if(t(l)){n&&(r.push(n.trim()),n=""),n=l,i&&!t(i)&&(n+=" "+i,s(i)||!d||t(d)?e+=1:(n+=" "+d,e+=2));continue}n&&(n+=" "+l,s(l)&&(r.push(n.trim()),n=""))}return n&&r.push(n.trim()),r})(t).join("\n"),a=v.default.parseStatementText(s);if(!a.length)return void q("info","No recurring-looking rows detected. Try another export.");let r=a.map(e=>{var t;return{name:e.name,category:e.category||"other",cost:Number(e.cost||0),frequency:e.frequency||"monthly",nextBilling:e.nextBilling||"",lastUsed:e.lastUsed||"",confidence:null!=(t=e.confidence)?t:90,meta:e}});V(r);let n=eT(a);Y({...n,windowLabel:eO(a)}),Z(eL(t,r))}else{t=await e.text();let s=v.default.parseStatementText(t);if(!s.length)return void q("info","No recurring-looking rows detected. Try another export.");let a=function(e){let t=[];if(e.forEach(e=>{[e.lastUsed,e.nextBilling,e.signUpDate].forEach(e=>{let s=e?new Date(e):null;s&&!isNaN(s.getTime())&&t.push(s)})}),!t.length)return null;let s=new Date(Math.max(...t.map(e=>e.getTime())));return new Date(s.getFullYear(),s.getMonth(),1)}(s);a&&M(a);let r=s.map(e=>{var t;return{name:e.name,category:e.category||"other",cost:Number(e.cost||0),frequency:e.frequency||"monthly",nextBilling:e.nextBilling||"",lastUsed:e.lastUsed||"",confidence:null!=(t=e.confidence)?t:90,meta:e}});V(r);let n=eT(s);Y({...n,windowLabel:eO(s)}),Z(eL(t,r))}G(!0)}catch(e){console.error(e),q("error","Error processing file. Check the format and try again.")}finally{z(!1)}},ei=async()=>{if((null==e?void 0:e.uid)&&H.length)try{z(!0);let a=[],r=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"").slice(0,64),n=e=>Math.round((Number(e)+Number.EPSILON)*100)/100;for(let l of H){var t,s;let i="scan_".concat(e.uid,"_").concat(r(l.name),"_").concat(Math.round(100*n(l.cost)),"_").concat(l.frequency),d=(0,g.doc)((0,g.collection)(p.db,"subscriptions"),i),o=function(e){let t={};for(let[s,a]of Object.entries(e))void 0!==a&&("number"==typeof a&&Number.isNaN(a)||(t[s]=a));return t}({userId:e.uid,name:l.name,category:l.category,cost:n(l.cost),amount:n(l.cost),monthlyFee:n(l.cost),frequency:l.frequency||"monthly",nextBilling:l.nextBilling||void 0,lastUsed:l.lastUsed||void 0,confidence:null!=(s=l.confidence)?s:90,dayOfMonth:null==(t=l.meta)?void 0:t.billingDate,updatedAt:g.Timestamp.now(),createdAt:g.Timestamp.now(),source:"bank_scan"});a.push((0,g.setDoc)(d,o,{merge:!0}))}await Promise.all(a),q("success","Saved ".concat(H.length," subscription").concat(H.length>1?"s":"")),G(!1)}catch(e){console.error(e),q("error","Failed to save subscriptions.")}finally{z(!1)}},{items:ed,loading:eo,error:ec}=function(e,t){let[a,r]=(0,s.useState)([]),[n,l]=(0,s.useState)(!0),[i,d]=(0,s.useState)(null),o=null==t?void 0:t.getFullYear(),c=null==t?void 0:t.getMonth(),u=null!=o&&null!=c?eS(o,c):31;return(0,s.useEffect)(()=>{if(!e)return void l(!1);l(!0);let s=(0,g.query)((0,g.collection)(p.db,"subscriptions"),(0,g.where)("userId","==",e)),a=(0,g.onSnapshot)(s,e=>{let s=[];e.forEach(e=>{var a,r,n,l,i,d;let o=e.data();if(t&&(eF(o,t)||!function(e,t){let s=(e.frequency||"monthly").toLowerCase();if("monthly"===s||"weekly"===s||"unknown"===s)return!0;let a=e.nextBilling||e.signUpDate;if(!a)return!1;let r=new Date(a);return!isNaN(r.getTime())&&r.getMonth()===t.getMonth()}(o,t)))return;let c=f.ValidationUtils.sanitizeMerchantName(o.name||o.merchant||o.serviceName||"Unknown Service"),m=(i=null!=(n=null!=(r=null!=(a=o.cost)?a:o.amount)?r:o.monthlyFee)?n:0,d=o.frequency,!i||i<=0?0:"annual"===d?eA(i/12):"weekly"===d?eA(4.33*i):eA(i));if(!f.ValidationUtils.isValidAmount(m))return void console.warn("Invalid amount for ".concat(c,": ").concat(m));let h=eC((e=>{var t;let s=Number(null!=(t=e.billingDate)?t:e.dayOfMonth);if(Number.isFinite(s)&&s>=1&&s<=31)return s;if(e.nextBilling){let t=new Date(e.nextBilling);if(!isNaN(t.getTime()))return t.getDate()}let a=e.lastUsed||e.signUpDate;if(a){let e=new Date(a);if(!isNaN(e.getTime()))return e.getDate()}return 1})(o),1,u),x=eB[o.category||""]||"other";s.push({id:e.id,name:c,category:x,cost:m,day:h,emoji:(e=>{for(let[t,s]of Object.entries(e_))if((e||"").toLowerCase().includes(t.toLowerCase()))return s;return"💳"})(c),type:"subscription",savingOpportunity:null!=(l=o.savingOpportunity)?l:70>(o.confidence||0)?m:0,raw:o})}),r(s),d(null),l(!1)},e=>{console.error("SubScan listener error",e),d("Failed to load subscription data"),l(!1)});return()=>a()},[e,o,c,u,t]),{items:a,loading:n,error:i}}(null==e?void 0:e.uid,S),eu=function(e,t){let[a,r]=(0,s.useState)([]);return(0,s.useEffect)(()=>{if(!e||!t)return;let s=(0,g.query)((0,g.collection)(p.db,"plannedItems"),(0,g.where)("userId","==",e)),a=(0,g.onSnapshot)(s,e=>{let s=[];e.forEach(e=>{let a=e.data();if(function(e,t){let s=t.getFullYear(),a=t.getMonth();if("once"===e.frequency){if(!e.date)return!1;let t=new Date(e.date);return t.getFullYear()===s&&t.getMonth()===a}if("monthly"===e.frequency){let t=!e.start||new Date(e.start)<=new Date(s,a,1),r=!e.end||new Date(e.end)>=new Date(s,a+1,0);return t&&r}if("annual"===e.frequency){let t=e.start||e.date;return!!t&&new Date(t).getMonth()===a}return!1}(a,t)){var r;s.push({id:e.id,name:f.ValidationUtils.sanitizeMerchantName(a.name||"Planned item"),category:a.category||"other",cost:eA(a.amount||0),day:"once"===a.frequency&&a.date?new Date(a.date).getDate():eC(null!=(r=a.dayOfMonth)?r:1,1,eS(t.getFullYear(),t.getMonth())),emoji:"📝",type:"planned",priority:"goals",raw:a})}}),r(s)});return()=>a()},[e,t]),a}(null==e?void 0:e.uid,S),em=k||eo,eh=(0,s.useMemo)(()=>[...ed,...eu],[ed,eu]),ex=S.getFullYear(),eg=S.getMonth(),ep=eS(ex,eg),eb=(new Date(ex,eg,1).getDay()+6)%7,ey=(0,s.useMemo)(()=>{let e=C.toLowerCase();return eh.filter(t=>("all"===_||t.category===_)&&(!e||"".concat(t.name," ").concat(t.category," ").concat(t.type).toLowerCase().includes(e)))},[C,eh,_]),ef=(0,s.useMemo)(()=>{let e=Array.from({length:ep+1},()=>[]);ey.forEach(t=>{e[eC(t.day,1,ep)].push(t)});for(let t=1;t<=ep;t++)e[t].sort((e,t)=>e.type!==t.type?"subscription"===e.type?-1:1:(t.cost||0)-(e.cost||0));return e},[ey,ep]),ej=(0,s.useMemo)(()=>ef.map(e=>e.reduce((e,t)=>e+((null==t?void 0:t.cost)||0),0)),[ef]),ev=(0,s.useMemo)(()=>ej.reduce((e,t)=>e+(t||0),0),[ej]),eR=(0,s.useMemo)(()=>eh.reduce((e,t)=>e+(t.savingOpportunity||0),0),[eh]),[eI,ez]=(0,s.useState)("1200");(0,s.useEffect)(()=>{ez(String(D))},[D]);let eU=eC(Math.min(ev,D)/(D||1)*100,0,100),eq=(0,s.useMemo)(()=>{let e=[],t=1-eb;for(let s=0;s<6;s++){let s=[];for(let e=0;e<7;e++)s.push(t>=1&&t<=ep?t:null),t++;e.push(s)}return e},[eb,ep]),eP=e=>{let t=new Date(S);t.setMonth(t.getMonth()+e),M(t)};async function eG(t){if(!(null==e?void 0:e.uid)||"subscription"!==t.type)return;let s=S.getFullYear(),a=S.getMonth(),r=(0,g.doc)(p.db,"subscriptions",t.id);await (0,g.setDoc)(r,{userId:e.uid,pausedUntil:new Date(s,a+1,0).toISOString().slice(0,10),updatedAt:(0,g.serverTimestamp)()},{merge:!0}),q("info","Paused ".concat(t.name," for ").concat(ek(S)))}async function eH(t){if(!(null==e?void 0:e.uid)||"subscription"!==t.type)return;let s=(0,g.doc)(p.db,"subscriptions",t.id);await (0,g.setDoc)(s,{userId:e.uid,pausedUntil:(0,g.deleteField)(),updatedAt:(0,g.serverTimestamp)()},{merge:!0}),q("success","Resumed ".concat(t.name))}return em?(0,t.jsx)(j.LoadingState,{message:"Loading your subscription data",type:"dashboard"}):ec?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-red-600 mb-4",children:ec}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gradient-to-b from-[#fafafa] to-[#f3f6ff]",children:[(0,t.jsx)("header",{className:"sticky top-0 z-30 backdrop-blur bg-white/70 border-b",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-5 py-4 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center shadow-sm rotate-[-3deg]",children:(0,t.jsx)("span",{className:"text-white font-bold",children:"S"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-extrabold text-gray-900",children:"SubScan"}),(0,t.jsxs)("span",{className:"hidden sm:inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100",children:[(0,t.jsx)(a.Calendar,{className:"w-3.5 h-3.5"})," live data"]})]})]}),(0,t.jsxs)("div",{className:"hidden sm:flex items-center gap-2",children:[(0,t.jsxs)("label",{className:"px-3 py-1.5 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg flex items-center gap-2 shadow hover:brightness-105 cursor-pointer ".concat(O?"opacity-50 pointer-events-none":""),children:[(0,t.jsx)(c.Upload,{className:"w-4 h-4"}),O?"Processing…":"Upload & Review",(0,t.jsx)("input",{type:"file",accept:".txt,.csv,.pdf",className:"hidden",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&el(s)},disabled:O})]}),(0,t.jsx)("button",{onClick:()=>{window.location.hash="#budget"},className:"underline",children:"Plan budget →"}),(0,t.jsxs)("button",{onClick:()=>window.location.href="/pdf-extractor",className:"px-3 py-1.5 text-sm bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg flex items-center gap-2 shadow hover:brightness-105",children:[(0,t.jsx)(m.FileText,{className:"w-4 h-4"})," PDF Extract"]}),(0,t.jsxs)("button",{onClick:()=>window.location.href="/settings",className:"px-3 py-1.5 text-sm bg-white border rounded-lg flex items-center gap-2 hover:bg-gray-50",children:[(0,t.jsx)(u.Settings,{className:"w-4 h-4"})," Settings"]})]})]})}),U&&(0,t.jsx)("div",{className:["fixed bottom-4 right-4 z-50 px-4 py-3 rounded-xl shadow-lg text-sm text-white","success"===U.type?"bg-emerald-600":"error"===U.type?"bg-rose-600":"bg-slate-700"].join(" "),children:U.msg}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-5 py-6 space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Total Monthly"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:eM(ev)}),(0,t.jsxs)("p",{className:"text-xs opacity-75",children:[ed.length," subscriptions"]})]}),(0,t.jsx)(r.DollarSign,{className:"w-8 h-8 opacity-90"})]})}),(0,t.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-5 text-white",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Budget"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)("input",{className:"w-28 px-2 py-1 rounded bg-white/90 text-gray-900 text-sm",value:eI,onChange:e=>ez(e.target.value),onBlur:()=>T(Number(eI)||0)}),(0,t.jsx)("span",{className:"text-sm/5 opacity-90",children:"Remaining"})]}),(0,t.jsx)("p",{className:"text-2xl font-bold mt-1",children:eM((Number(eI)||0)-ev)})]}),(0,t.jsx)(l.Target,{className:"w-8 h-8 opacity-90"})]}),(0,t.jsx)("div",{className:"mt-3 h-2.5 w-full bg-white/30 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-white/90",style:{width:"".concat(eU,"%")}})})]}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Potential Savings"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:eM(eR)}),(0,t.jsx)("p",{className:"text-xs opacity-75",children:"Optimise or cancel"})]}),(0,t.jsx)(l.Target,{className:"w-8 h-8 opacity-90"})]})}),(0,t.jsx)("div",{className:"bg-gradient-to-r from-rose-500 to-rose-600 rounded-2xl p-5 text-white",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm/5 opacity-90",children:"Upcoming Week"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:eM(ej.slice(new Date().getDate(),new Date().getDate()+7).reduce((e,t)=>e+(t||0),0))}),(0,t.jsx)("p",{className:"text-xs opacity-75",children:"Bills due"})]}),(0,t.jsx)(n.AlertTriangle,{className:"w-8 h-8 opacity-90"})]})})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>eP(-1),className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200",children:(0,t.jsx)(i.ChevronLeft,{className:"w-5 h-5 text-gray-700"})}),(0,t.jsx)("h2",{className:"text-xl font-extrabold text-gray-900",children:ek(S)}),(0,t.jsx)("button",{onClick:()=>eP(1),className:"p-2 rounded-xl bg-gray-100 hover:bg-gray-200",children:(0,t.jsx)(d.ChevronRight,{className:"w-5 h-5 text-gray-700"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"w-4 h-4 absolute left-2 top-2.5 text-gray-400"}),(0,t.jsx)("input",{value:C,onChange:e=>B(e.target.value),placeholder:"Search subscriptions...",className:"pl-8 pr-3 py-2 bg-gray-50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Filter,{className:"w-4 h-4 absolute left-2 top-2.5 text-gray-400"}),(0,t.jsxs)("select",{value:_,onChange:e=>A(e.target.value),className:"pl-8 pr-3 py-2 bg-gray-50 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"all",children:"All"}),["streaming","software","fitness","housing","food","savings","insurance","transport","utilities","entertainment","other"].map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("button",{onClick:()=>I(e=>!e),className:"px-3 py-2 rounded-xl text-sm border ".concat(R?"bg-yellow-50 border-yellow-300":"bg-white hover:bg-gray-50"),children:[(0,t.jsx)(x.Clock,{className:"inline w-4 h-4 mr-1"})," ",R?"Hide":"Show"," date debug"]})]})]}),(0,t.jsxs)(w.default,{children:[(0,t.jsx)(eE,{subs:ed,planned:eu}),(0,t.jsx)(eN,{})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 bg-gray-50 border-b rounded-2xl",children:ew.map(e=>(0,t.jsx)("div",{className:"p-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide",children:e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-2 p-3",children:eq.map((e,a)=>(0,t.jsx)(s.default.Fragment,{children:e.map((e,s)=>{if(!e)return(0,t.jsx)("div",{className:"h-24 rounded-2xl border border-dashed border-gray-200 bg-gray-50"},"".concat(a,"-").concat(s));let r=ef[e],n=ej[e]||0,l=(e=>{let t=new Date;return e===t.getDate()&&eg===t.getMonth()&&ex===t.getFullYear()})(e);return(0,t.jsxs)("button",{onClick:()=>F({day:e,items:r}),className:["relative h-24 p-2 rounded-2xl border text-left shadow-[0_1px_0_rgba(0,0,0,0.02)] transition will-change-transform hover:shadow-sm hover:-translate-y-0.5 hover:rotate-[-0.25deg]",0===n?"bg-white/80":n<100?"bg-sky-50":n<500?"bg-amber-50":n<1e3?"bg-rose-50":"bg-fuchsia-50",l?"ring-2 ring-blue-400 bg-blue-50":""].join(" "),children:[(0,t.jsx)("div",{className:"absolute -top-1.5 -left-1.5 w-6 h-6 rounded-full bg-gradient-to-br from-yellow-200 to-pink-200 shadow border border-white rotate-[-6deg]"}),(0,t.jsx)("div",{className:"text-xs font-bold mb-1 ".concat(l?"text-blue-700":"text-gray-700"),children:e}),(0,t.jsxs)("div",{className:"space-y-1 overflow-hidden",children:[r.slice(0,2).map(e=>(0,t.jsxs)("div",{className:"rounded-xl px-2 py-1 bg-white/70 backdrop-blur border border-white/60 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,t.jsx)("span",{className:"text-xs",children:e.emoji}),(0,t.jsx)("span",{className:"text-[11px] truncate",children:e.name})]}),(0,t.jsx)("span",{className:"text-[11px] font-semibold text-gray-800",children:eM(e.cost)})]},e.id)),r.length>2&&(0,t.jsxs)("div",{className:"text-[11px] text-gray-500 text-center",children:["+",r.length-2," more"]})]}),n>0&&(0,t.jsxs)("div",{className:"absolute bottom-1 right-1 inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white/80 border border-white/70 text-[11px] text-gray-800",children:[(0,t.jsx)("span",{children:0===n?"🙂":n<100?"💨":n<500?"⚡":n<1e3?"🔥":"💥"}),(0,t.jsx)("span",{children:eM(n)})]})]},"".concat(a,"-").concat(s))})},a))}),E&&(0,t.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,t.jsx)("div",{className:"flex-1 bg-black/40",onClick:()=>F(null)}),(0,t.jsxs)("div",{className:"w-full max-w-md bg-white h-full shadow-xl p-6 overflow-y-auto rounded-l-3xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-extrabold",children:["Day ",E.day]}),(0,t.jsx)("button",{onClick:()=>F(null),className:"px-2 py-1 rounded-xl hover:bg-gray-100",children:"Close"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[0===E.items.length&&(0,t.jsx)("div",{className:"rounded-2xl border p-4 bg-gray-50 text-sm text-gray-600",children:"No items on this day."}),E.items.map(e=>{var s,a,r;let n="subscription"===e.type&&(null==(s=e.raw)?void 0:s.pausedUntil)&&eF(e.raw,S);return(0,t.jsxs)("div",{className:"border rounded-2xl p-3 flex items-center justify-between bg-gradient-to-r from-white to-gray-50",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-lg",children:e.emoji}),(0,t.jsx)("p",{className:"font-semibold text-gray-900 truncate",children:e.name})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[e.type," • ",(0,t.jsx)("span",{className:"capitalize",children:e.category})," • ",eM(e.cost),e.savingOpportunity?" • Save ".concat(eM(e.savingOpportunity)):""]}),R&&e.raw&&(0,t.jsx)("div",{className:"mt-1 text-xs text-gray-500",children:"subscription"===e.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:["nextBilling: ",e.raw.nextBilling||"-"]}),(0,t.jsxs)("div",{children:["billingDate/dayOfMonth: ",null!=(r=null!=(a=e.raw.billingDate)?a:e.raw.dayOfMonth)?r:"-"]}),(0,t.jsxs)("div",{children:["lastUsed: ",e.raw.lastUsed||"-"," • signUpDate: ",e.raw.signUpDate||"-"]}),(0,t.jsxs)("div",{children:["pausedUntil: ",e.raw.pausedUntil||"-"]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:["planned.freq: ",e.raw.frequency]}),(0,t.jsxs)("div",{children:["planned.date: ",e.raw.date||"-"]}),(0,t.jsxs)("div",{children:["planned.dayOfMonth: ",e.raw.dayOfMonth||"-"]})]})})]}),"subscription"===e.type?(0,t.jsx)("button",{onClick:()=>n?eH(e):eG(e),className:"px-2.5 py-1.5 text-sm rounded-xl border bg-white hover:bg-gray-50",children:n?"Resume":"Pause (this month)"}):(0,t.jsx)("button",{className:"px-2.5 py-1.5 text-sm rounded-xl border bg-white hover:bg-gray-50",children:"Edit"})]},e.id)}),(0,t.jsx)("div",{className:"pt-2 flex justify-end",children:(0,t.jsx)("button",{onClick:()=>Q({day:E.day}),className:"px-3 py-2 rounded-xl text-sm border bg-white hover:bg-gray-50",children:"Add item to this day"})})]})]})]}),K&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl p-5 shadow",children:[(0,t.jsxs)("h4",{className:"text-lg font-semibold mb-3",children:["Add planned item — ",ek(S)," ",K.day]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("input",{className:"w-full border rounded-lg px-3 py-2 text-sm",placeholder:"Name (e.g., School Fees)",value:$.name,onChange:e=>X(t=>({...t,name:e.target.value}))}),(0,t.jsx)("input",{className:"w-full border rounded-lg px-3 py-2 text-sm",placeholder:"Amount (e.g., 120.00)",value:$.amount,onChange:e=>X(t=>({...t,amount:e.target.value}))}),(0,t.jsxs)("select",{className:"w-full border rounded-lg px-3 py-2 text-sm",value:$.freq,onChange:e=>X(t=>({...t,freq:e.target.value})),children:[(0,t.jsx)("option",{value:"once",children:"One-off"}),(0,t.jsx)("option",{value:"monthly",children:"Monthly"}),(0,t.jsx)("option",{value:"annual",children:"Annual"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2 justify-end",children:[(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>Q(null),children:"Cancel"}),(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg text-white bg-gray-900 hover:bg-black",onClick:async()=>{if(!(null==e?void 0:e.uid))return;let t=S.getFullYear(),s=S.getMonth(),a=K.day,r=Number($.amount||"0");$.name&&r&&!(r<=0)&&(await (0,g.addDoc)((0,g.collection)(p.db,"plannedItems"),{userId:e.uid,name:f.ValidationUtils.sanitizeMerchantName($.name),category:"other",amount:r,frequency:$.freq,..."once"===$.freq?{date:new Date(t,s,a).toISOString().slice(0,10)}:{dayOfMonth:eC(a,1,31)},createdAt:(0,g.serverTimestamp)(),updatedAt:(0,g.serverTimestamp)()}),X({name:"",amount:"",freq:"once"}),Q(null),q("success","Planned item added"))},children:"Add"})]})]})}),ee&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40",children:(0,t.jsxs)("div",{className:"w-full max-w-md bg-white rounded-2xl p-5 shadow",children:[(0,t.jsx)("h4",{className:"text-lg font-semibold mb-3",children:"Manage categories"}),(0,t.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,t.jsx)("input",{className:"flex-1 border rounded-lg px-3 py-2 text-sm",placeholder:"Add category (e.g., Travel)",value:er,onChange:e=>en(e.target.value),onKeyDown:e=>{"Enter"===e.key&&er.trim()&&(ea(e=>Array.from(new Set([...e,er.trim()]))),en(""))}}),(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg text-sm border bg-white hover:bg-gray-50",onClick:()=>{er.trim()&&(ea(e=>Array.from(new Set([...e,er.trim()]))),en(""))},children:"Add"})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:es.map(e=>(0,t.jsxs)("span",{className:"inline-flex items-center gap-2 px-2.5 py-1 rounded-full bg-gray-100 text-gray-800 text-xs",children:[e,(0,t.jsx)("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>ea(t=>t.filter(t=>t!==e)),"aria-label":"remove ".concat(e),title:"remove ".concat(e),children:"×"})]},e))}),(0,t.jsx)("div",{className:"mt-4 flex justify-end gap-2",children:(0,t.jsx)("button",{className:"px-3 py-2 rounded-lg border bg-white hover:bg-gray-50",onClick:()=>et(!1),children:"Close"})})]})}),(0,t.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-3xl p-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-lg font-bold",children:"Upload bank statements to auto-detect subscriptions"}),(0,t.jsx)("p",{className:"text-sm/6 opacity-90",children:"Paste your bank statement text or upload CSV files to automatically find recurring payments."})]}),(0,t.jsxs)("label",{className:"px-4 py-2 bg-white text-gray-900 rounded-xl font-semibold flex items-center gap-2 hover:bg-gray-100 transition-colors cursor-pointer ".concat(O?"opacity-50 pointer-events-none":""),children:[(0,t.jsx)(c.Upload,{className:"w-4 h-4"}),O?"Processing…":"Upload & Review",(0,t.jsx)("input",{type:"file",accept:".txt,.csv,.pdf",className:"hidden",onChange:e=>{var t;let s=null==(t=e.target.files)?void 0:t[0];s&&el(s)},disabled:O})]})]}),(0,t.jsx)(N.default,{open:P,onClose:()=>G(!1),results:H,stats:W,candidates:J,onAddManual:e=>{let t=e.frequency||(e.amount>1e3?"annual":"monthly");V(s=>[...s,{name:f.ValidationUtils.sanitizeMerchantName(e.name)||"Unknown Service",category:"other",cost:Math.round((e.amount+Number.EPSILON)*100)/100,frequency:t,confidence:60,meta:{source:"candidate",ref:e.ref}}]),Z(t=>t.filter(t=>t.name!==e.name||t.amount!==e.amount)),q("info",'Added "'.concat(e.name,'" to review'))},onSaveAll:ei,onExportCSV:()=>(e=>{let t=new Blob([["name,category,cost,frequency,nextBilling,lastUsed,confidence",...e.map(e=>{var t,s;return[JSON.stringify(e.name||""),JSON.stringify(e.category||""),null!=(t=e.cost)?t:0,JSON.stringify(e.frequency||""),JSON.stringify(e.nextBilling||""),JSON.stringify(e.lastUsed||""),null!=(s=e.confidence)?s:""].join(",")})].join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="subscan_review.csv",a.click(),URL.revokeObjectURL(s)})(H)})]})]})}e.s(["default",()=>eG],33819);let eP=["subscriptions","plannedItems","categories","envelopes","insights","detectedSubscriptions","userSubscriptions","scanResults"];function eG(){let[e]=(0,b.useAuthState)(p.auth),[a,r]=(0,s.useState)(!1),[n,l]=(0,s.useState)(""),i=e=>l(t=>t+e+"\n"),d=async()=>{if(!(null==e?void 0:e.uid))return void alert("Not signed in");if(confirm("This will permanently delete all your data in the listed collections. Continue?")){r(!0),l("");try{for(let t of eP){i("→ Deleting from ".concat(t,"…"));let s=null,a=0;for(;;){let r=(0,g.query)((0,g.collection)(p.db,t),(0,g.where)("userId","==",e.uid),(0,g.orderBy)("__name__"),...s?[(0,g.startAfter)(s)]:[],(0,g.limit)(400)),n=await (0,g.getDocs)(r);if(n.empty)break;let l=(0,g.writeBatch)(p.db);n.docs.forEach(e=>l.delete(e.ref)),await l.commit(),a+=n.size,s=n.docs[n.docs.length-1]}i("   ✓ ".concat(a," docs deleted in ").concat(t))}i("All done ✅")}catch(e){console.error(e),i("Error: ".concat((null==e?void 0:e.message)||e)),alert("Some deletes failed. Check console/log.")}finally{r(!1)}}};return(0,t.jsxs)("div",{className:"p-4 border rounded-xl bg-red-50",children:[(0,t.jsx)("h3",{className:"font-semibold text-red-700 mb-2",children:"Danger Zone: Clear My Data"}),(0,t.jsx)("button",{onClick:d,disabled:a,className:"px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:a?"Deleting…":"Delete all my data"}),(0,t.jsx)("pre",{className:"mt-3 text-xs text-red-800 whitespace-pre-wrap",children:n})]})}e.s(["ErrorBoundary",()=>eW],46417),e.i(47167);var eH=e.i(99749),eV=s;class eW extends eV.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var s,a;this.setState({errorInfo:t}),console.error("ErrorBoundary caught an error:",e,t),null==(s=(a=this.props).onError)||s.call(a,e,t)}render(){if(this.state.hasError){var e,s;if(this.props.fallback)return this.props.fallback;let a=this.state.retryCount<this.maxRetries,r=(null==(e=this.state.error)?void 0:e.message.includes("Network"))||(null==(s=this.state.error)?void 0:s.message.includes("fetch"));return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(n.AlertTriangle,{className:"w-8 h-8 text-red-600"})}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:r?"We're having trouble connecting. Please check your internet connection and try again.":"An unexpected error occurred. Our team has been notified and is working on a fix."}),!1,(0,t.jsxs)("div",{className:"space-y-3",children:[a&&(0,t.jsxs)("button",{onClick:this.handleRetry,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center",children:[(0,t.jsx)(T,{className:"w-4 h-4 mr-2"}),"Try Again (",this.maxRetries-this.state.retryCount," left)"]}),(0,t.jsxs)("button",{onClick:this.handleGoHome,className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center",children:[(0,t.jsx)(A,{className:"w-4 h-4 mr-2"}),"Go to Dashboard"]})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-4",children:["Error ID: ",Date.now().toString(36)]})]})})}return this.props.children}constructor(e){super(e),(0,eH._)(this,"maxRetries",3),(0,eH._)(this,"handleRetry",()=>{this.state.retryCount<this.maxRetries&&this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1}))}),(0,eH._)(this,"handleGoHome",()=>{window.location.href="/dashboard"}),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}}}]);